
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Algorand.algorand_model</title>
<meta name="description" content="Documentation of Coq module Algorand.algorand_model" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Algorand.algorand_model</h1>
<div class="coq">
<span class="kwd">From</span> <span class="id">mathcomp</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.all_ssreflect.html">all_ssreflect</a></span>.<br/>
<span class="kwd">From</span> <span class="id">mathcomp</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.finmap.html">finmap</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.multiset.html">multiset</a></span>.<br/>
<span class="kwd">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Reals.html">Reals</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html">Relation_Definitions</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Relations.Relation_Operators.html">Relation_Operators</a></span>.<br/>
<span class="kwd">From</span> <span class="id">mathcomp</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.analysis.boolp.html">boolp</a></span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.analysis.Rstruct.html">Rstruct</a></span>.<br/>
<span class="kwd">From</span> <span class="id">RecordUpdate</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">RecordSet</span>.<br/>
<span class="kwd">From</span> <span class="id">Algorand</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="Algorand.fmap_ext.html">fmap_ext</a></span>.<br/>
<span class="kwd">Import</span> <span class="id">RecordSetNotations</span>.<br/>
<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="kwd">Arguments</span>.<br/>
<span class="id">Unset</span> <span class="id">Strict</span> <span class="kwd">Implicit</span>.<br/>
<span class="id">Unset</span> <span class="id">Printing</span> <span class="kwd">Implicit</span> <span class="id">Defensive</span>.<br/>
<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">mset_scope</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">fmap_scope</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">fset_scope</span>.<br/>
<br/>
<h1> Algorand parameters, data, and transition system </h1>
<br/>
<div class="doc">This module contains the definitions that comprise the Algorand consensus
protocol model. </div>
<br/>
<h2> Basic parameters </h2>
<br/>
<div class="doc">We assume a finite set of users. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="UserId">UserId</a></span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#Finite.Exports.finType">finType</a></span>.<br/>
<br/>
<div class="doc">We assume a countable set of values (blocks and block hashes). </div>
<span class="kwd">Parameter</span> <span class="id"><a name="Value">Value</a></span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#Choice.Exports.choiceType">choiceType</a></span>.<br/>
<br/>
<h2> Message type </h2>
<br/>
<div class="doc">An enumeration of all possible types (headers) of messages. </div>
<span class="kwd">Inductive</span> <span class="id"><a name="MessageType">MessageType</a></span> :=<br/>
| <span class="id"><a name="Block">Block</a></span><br/>
| <span class="id"><a name="Proposal">Proposal</a></span><br/>
| <span class="id"><a name="Reproposal">Reproposal</a></span><br/>
| <span class="id"><a name="Softvote">Softvote</a></span><br/>
| <span class="id"><a name="Certvote">Certvote</a></span><br/>
| <span class="id"><a name="Nextvote_Open">Nextvote_Open</a></span><br/>
| <span class="id"><a name="Nextvote_Val">Nextvote_Val</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="MessageType_eq">MessageType_eq</a></span> (<span class="id">a</span> <span class="id">b</span>:<span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssreflect.html#nosimpl">nosimpl</a></span> <span class="kwd">match</span> <span class="id">a</span>,<span class="id">b</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span>, <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Proposal">Proposal</a></span>, <span class="id"><a href="Algorand.algorand_model.html#Proposal">Proposal</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Reproposal">Reproposal</a></span>, <span class="id"><a href="Algorand.algorand_model.html#Reproposal">Reproposal</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span>, <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span>, <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span>, <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span>, <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="MessageType_eqP">MessageType_eqP</a></span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#Equality.axiom">Equality.axiom</a></span> <span class="id"><a href="Algorand.algorand_model.html#MessageType_eq">MessageType_eq</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof1')">Proof.</span></div>
<div class="proofscript" id="proof1">
&nbsp;&nbsp;<span class="id">move</span> =&gt; <span class="id">a</span> <span class="id">b</span>;<span class="id">apply</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Bool.Bool.html#iff_reflect">Bool.iff_reflect</a></span>;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> <span class="id">move</span> &lt;-;<span class="id">destruct</span> <span class="id">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> <span class="id">move</span>/(<span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrbool.html#ifT">ifT</a></span> (<span class="id">a</span>=<span class="id">b</span>) <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span>) =&gt; &lt;-;<span class="id">destruct</span> <span class="id">a</span>, <span class="id">b</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Make <span class="bracket"><span class="id">MessageType</span></span> a <span class="bracket"><span class="id">finType</span></span> by showing a mapping
to the MathComp bounded <span class="bracket"><span class="id">nat</span></span> type <span class="bracket">'<span class="id">I_7</span></span>.
</div>
<span class="kwd">Definition</span> <span class="id"><a name="mtype2o">mtype2o</a></span> (<span class="id">m</span>:<span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span>) : '<span class="id">I_7</span> :=<br/>
&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#inord">inord</a></span> (<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Proposal">Proposal</a></span> =&gt; 1<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Reproposal">Reproposal</a></span> =&gt; 2<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span> =&gt; 3<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span> =&gt; 4<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span> =&gt; 5<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span> =&gt; 6<br/>
&nbsp;&nbsp;<span class="kwd">end</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="o2mtype">o2mtype</a></span> (<span class="id">i</span>:'<span class="id">I_7</span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#val">val</a></span> <span class="id">i</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| 0 =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span><br/>
&nbsp;&nbsp;| 1 =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Algorand.algorand_model.html#Proposal">Proposal</a></span><br/>
&nbsp;&nbsp;| 2 =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Algorand.algorand_model.html#Reproposal">Reproposal</a></span><br/>
&nbsp;&nbsp;| 3 =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span><br/>
&nbsp;&nbsp;| 4 =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span><br/>
&nbsp;&nbsp;| 5 =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span><br/>
&nbsp;&nbsp;| 6 =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pcancel_MessageType_7">pcancel_MessageType_7</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrfun.html#pcancel">pcancel</a></span> <span class="id"><a href="Algorand.algorand_model.html#mtype2o">mtype2o</a></span> <span class="id"><a href="Algorand.algorand_model.html#o2mtype">o2mtype</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof2')">Proof.</span></div>
<div class="proofscript" id="proof2">
 <span class="kwd">by</span> <span class="id">case</span>;<span class="id">rewrite</span> /<span class="id"><a href="Algorand.algorand_model.html#o2mtype">o2mtype</a></span> /= <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#inordK">inordK</a></span>. Qed.</div>
<br/>
<div class="doc">Register canonical structures on <span class="bracket"><span class="id">MessageType</span></span>; needed for using it in <span class="bracket"><span class="id">fset</span></span>s, <span class="bracket"><span class="id">mset</span></span>s, etc. </div>
<span class="kwd">Canonical</span> <span class="id"><a name="messageType_eqType">messageType_eqType</a></span>     := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#Equality.Exports.EqType">EqType</a></span>     <span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#Equality.Mixin">Equality.Mixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#MessageType_eqP">MessageType_eqP</a></span>).<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="messageType_choiceType">messageType_choiceType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#Choice.Exports.ChoiceType">ChoiceType</a></span> <span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#PcanChoiceMixin">PcanChoiceMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#pcancel_MessageType_7">pcancel_MessageType_7</a></span>).<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="messageType_countType">messageType_countType</a></span>  := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#Countable.Exports.CountType">CountType</a></span>  <span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#PcanCountMixin">PcanCountMixin</a></span>  <span class="id"><a href="Algorand.algorand_model.html#pcancel_MessageType_7">pcancel_MessageType_7</a></span>).<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="messageType_finType">messageType_finType</a></span>    := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#Finite.Exports.FinType">FinType</a></span>    <span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.fintype.html#PcanFinMixin">PcanFinMixin</a></span>    <span class="id"><a href="Algorand.algorand_model.html#pcancel_MessageType_7">pcancel_MessageType_7</a></span>).<br/>
<br/>
<h2> Extended value type </h2>
<br/>
<div class="doc">Message payload type, packaging <span class="bracket"><span class="id">Value</span></span> and other data. </div>
<span class="kwd">Inductive</span> <span class="id"><a name="ExValue">ExValue</a></span> :=<br/>
&nbsp;&nbsp;| <span class="id"><a name="val">val</a></span>      : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> -&gt; <span class="id">ExValue</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="step_val">step_val</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">ExValue</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="repr_val">repr_val</a></span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">ExValue</span><br/>
&nbsp;&nbsp;| <span class="id"><a name="next_val">next_val</a></span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id">ExValue</span>.<br/>
<br/>
<div class="doc">Make <span class="bracket"><span class="id">ExValue</span></span> an equality type and a choice type. </div>
<span class="kwd">Definition</span> <span class="id"><a name="codeExVal">codeExVal</a></span> (<span class="id">e</span>:<span class="id"><a href="Algorand.algorand_model.html#ExValue">ExValue</a></span>) :<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> + (<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> * <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) + (<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">e</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">mv</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">mv</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#step_val">step_val</a></span> <span class="id">k</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">k</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#repr_val">repr_val</a></span> <span class="id">v</span> <span class="id">user</span> <span class="id">n</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> (<span class="id">v</span>, <span class="id">user</span>, <span class="id">n</span>))<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#next_val">next_val</a></span> <span class="id">v</span> <span class="id">n</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> (<span class="id">v</span>,<span class="id">n</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="decodeExVal">decodeExVal</a></span> (<span class="id">c</span>:<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> + <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> + (<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> * <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) + (<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>)) : <span class="id"><a href="Algorand.algorand_model.html#ExValue">ExValue</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">c</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> <span class="id">mv</span>)) =&gt; <span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">mv</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> <span class="id">k</span>)) =&gt; <span class="id"><a href="Algorand.algorand_model.html#step_val">step_val</a></span> <span class="id">k</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inl">inl</a></span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> (<span class="id">v</span>, <span class="id">user</span>, <span class="id">n</span>)) =&gt; <span class="id"><a href="Algorand.algorand_model.html#repr_val">repr_val</a></span> <span class="id">v</span> <span class="id">user</span> <span class="id">n</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#inr">inr</a></span> (<span class="id">v</span>,<span class="id">n</span>) =&gt; <span class="id"><a href="Algorand.algorand_model.html#next_val">next_val</a></span> <span class="id">v</span> <span class="id">n</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cancelExVal">cancelExVal</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrfun.html#pcancel">pcancel</a></span> <span class="id"><a href="Algorand.algorand_model.html#codeExVal">codeExVal</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Algorand.algorand_model.html#decodeExVal">decodeExVal</a></span> <span class="id">x</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof3')">Proof.</span></div>
<div class="proofscript" id="proof3">
 <span class="kwd">by</span> <span class="id">case</span>. Qed.</div>
<br/>
<div class="doc">Register canonical structures on <span class="bracket"><span class="id">ExValue</span></span>; needed for using it in <span class="bracket"><span class="id">fset</span></span>s, <span class="bracket"><span class="id">mset</span></span>s, etc. </div>
<span class="kwd">Canonical</span> <span class="id"><a name="exValue_eqType">exValue_eqType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#Equality.Exports.EqType">EqType</a></span> <span class="id"><a href="Algorand.algorand_model.html#ExValue">ExValue</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#PcanEqMixin">PcanEqMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#cancelExVal">cancelExVal</a></span>).<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="exValue_choiceType">exValue_choiceType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#Choice.Exports.ChoiceType">ChoiceType</a></span> <span class="id"><a href="Algorand.algorand_model.html#ExValue">ExValue</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#PcanChoiceMixin">PcanChoiceMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#cancelExVal">cancelExVal</a></span>).<br/>
<br/>
<h2> Messages </h2>
<br/>
<div class="doc">A message is represented by a record type for convenience, but
can be viewed as a tuple <span class="bracket">(<span class="id">type</span>, <span class="id">ev</span>, <span class="id">r</span>, <span class="id">p</span>, <span class="id">id</span>)</span> where:
<ul>
<li>
 <span class="bracket"><span class="id">type</span></span> is the message type, and
</li>
<li>
 <span class="bracket"><span class="id">ev</span></span> is the message payload, and
</li>
<li>
 <span class="bracket"><span class="id">r</span></span> is the round value, and
</li>
<li>
 <span class="bracket"><span class="id">p</span></span> is the period value, and
</li>
<li>
 <span class="bracket"><span class="id">id</span></span> is the sending user's identifier. </li>
</ul>
</div>
<span class="kwd">Record</span> <span class="id"><a name="Msg">Msg</a></span> : <span class="kwd">Type</span> := <span class="id">mkMsg</span><br/>
&nbsp;{ <span class="id"><a name="msg_type">msg_type</a></span> : <span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span> ;<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a name="msg_ev">msg_ev</a></span> : <span class="id"><a href="Algorand.algorand_model.html#ExValue">ExValue</a></span> ;<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a name="msg_round">msg_round</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> ;<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a name="msg_period">msg_period</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> ;<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a name="msg_sender">msg_sender</a></span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span><br/>
&nbsp;}.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="codeMsg">codeMsg</a></span> (<span class="id">m</span> : <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) :=<br/>
(<span class="id"><a href="Algorand.algorand_model.html#msg_type">msg_type</a></span> <span class="id">m</span>, <span class="id"><a href="Algorand.algorand_model.html#msg_ev">msg_ev</a></span> <span class="id">m</span>, <span class="id"><a href="Algorand.algorand_model.html#msg_round">msg_round</a></span> <span class="id">m</span>, <span class="id"><a href="Algorand.algorand_model.html#msg_period">msg_period</a></span> <span class="id">m</span>, <span class="id"><a href="Algorand.algorand_model.html#msg_sender">msg_sender</a></span> <span class="id">m</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="decodeMsg">decodeMsg</a></span> <span class="id">c</span> :=<br/>
<span class="kwd">let</span>: (<span class="id"><a href="Algorand.algorand_model.html#msg_type">msg_type</a></span>, <span class="id"><a href="Algorand.algorand_model.html#msg_ev">msg_ev</a></span>, <span class="id"><a href="Algorand.algorand_model.html#msg_round">msg_round</a></span>, <span class="id"><a href="Algorand.algorand_model.html#msg_period">msg_period</a></span>, <span class="id"><a href="Algorand.algorand_model.html#msg_sender">msg_sender</a></span>) := <span class="id">c</span> <span class="kwd">in</span><br/>
<span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id">msg_type</span> <span class="id">msg_ev</span> <span class="id">msg_round</span> <span class="id">msg_period</span> <span class="id">msg_sender</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cancelMsg">cancelMsg</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrfun.html#pcancel">pcancel</a></span> <span class="id"><a href="Algorand.algorand_model.html#codeMsg">codeMsg</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Algorand.algorand_model.html#decodeMsg">decodeMsg</a></span> <span class="id">x</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof4')">Proof.</span></div>
<div class="proofscript" id="proof4">
 <span class="kwd">by</span> <span class="id">case</span>. Qed.</div>
<br/>
<div class="doc">Register canonical structures on <span class="bracket"><span class="id">Msg</span></span>; needed for using it in <span class="bracket"><span class="id">fset</span></span>s, <span class="bracket"><span class="id">mset</span></span>s, etc. </div>
<span class="kwd">Canonical</span> <span class="id"><a name="Msg_eqType">Msg_eqType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#Equality.Exports.EqType">EqType</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#PcanEqMixin">PcanEqMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#cancelMsg">cancelMsg</a></span>).<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="Msg_choiceType">Msg_choiceType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#Choice.Exports.ChoiceType">ChoiceType</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#PcanChoiceMixin">PcanChoiceMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#cancelMsg">cancelMsg</a></span>).<br/>
<br/>
<div class="doc">Messages are grouped by the target user, and are paired with a
delivery deadline. In the absence of a partition, messages must
be delivered before the deadline is reached. </div>
<span class="kwd">Definition</span> <span class="id"><a name="MsgPool">MsgPool</a></span> := {<span class="id">fmap</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; {<span class="id">mset</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>}}%<span class="id">mset</span>.<br/>
<br/>
<h2> Credentials </h2>
<br/>
<div class="doc">The credential of a user at a round-period-step triple.
Note: We abstract away the random value produced by an oracle
and the fact that credentials are interpreted as integer
values. Instead, we model the type of credentials as an
abstract totally ordered type. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="credType">credType</a></span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.order.html#Order.Total.Exports.orderType">orderType</a></span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>.<br/>
<br/>
<div class="doc">A credential is constructed using the user's identifier and the
current round-period-step values. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="credential">credential</a></span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#credType">credType</a></span>.<br/>
<br/>
<div class="doc">Credentials of two different users must be different. </div>
<span class="kwd">Axiom</span> <span class="id"><a name="credentials_different">credentials_different</a></span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">u</span> <span class="id">u</span>' : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>) (<span class="id">r</span> <span class="id">r</span>' : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">p</span> <span class="id">p</span>' : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">s</span> <span class="id">s</span>' : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>),<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;&gt; <span class="id">u</span>' -&gt; <span class="id"><a href="Algorand.algorand_model.html#credential">credential</a></span> <span class="id">u</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> &lt;&gt; <span class="id"><a href="Algorand.algorand_model.html#credential">credential</a></span> <span class="id">u</span>' <span class="id">r</span>' <span class="id">p</span>' <span class="id">s</span>'.<br/>
<br/>
<div class="doc">A predicate defining whether a given credential qualifies its
owner to be a committee member. This abstracts away from how
credential values are interpreted. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="committee_cred">committee_cred</a></span> : <span class="id"><a href="Algorand.algorand_model.html#credType">credType</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<div class="doc">Whether the credential is a committee credential for the given
round-period-step triple. </div>
<span class="kwd">Definition</span> <span class="id"><a name="comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#committee_cred">committee_cred</a></span> (<span class="id"><a href="Algorand.algorand_model.html#credential">credential</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>).<br/>
<br/>
<span class="kwd">Axiom</span> <span class="id"><a name="credentials_valid_period">credentials_valid_period</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>, <span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt; 1 &lt;= <span class="id">p</span>.<br/>
<br/>
<h2> User state </h2>
<br/>
<div class="doc">A proposal/reproposal record is a quadruple consisting of
a user id, a user's credential, a value and a boolean
indicating whether the record represents a proposal (<span class="bracket"><span class="id">true</span></span>)
or a reproposal (<span class="bracket"><span class="id">false</span></span>). </div>
<span class="kwd">Definition</span> <span class="id"><a name="PropRecord">PropRecord</a></span> := (<span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> * <span class="id"><a href="Algorand.algorand_model.html#credType">credType</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>)%<span class="id">type</span>.<br/>
<br/>
<div class="doc">A vote is a pair of a <span class="bracket"><span class="id">UserId</span></span> (the identifier of the voter)
and a <span class="bracket"><span class="id">Value</span></span> (the value voted for). </div>
<span class="kwd">Definition</span> <span class="id"><a name="Vote">Vote</a></span> := (<span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>)%<span class="id">type</span>.<br/>
<br/>
<div class="doc">The structure of a user's state. </div>
<span class="kwd">Record</span> <span class="id"><a name="UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">mkUState</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="corrupt">corrupt</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>; <span class="docright">(* a flag indicating whether the user is corrupt  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="round">round</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>; <span class="docright">(* the user's current round (starts at 1)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="period">period</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>; <span class="docright">(* the user's current period (starts at 1)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="step">step</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>; <span class="docright">(* the user's current step counter (starts at 1)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="timer">timer</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>; <span class="docright">(* the user's current timer value (since the beginning of the current period)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="deadline">deadline</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>; <span class="docright">(* the user's next deadline time value (since the beginning of the current period)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="p_start">p_start</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>; <span class="docright">(* the (local) time at which the user's current period started (i.e., local clock = p_start + timer)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="proposals">proposals</a></span> : {<span class="id">fsfun</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#PropRecord">PropRecord</a></span> <span class="kwd">with</span> [::]}; <span class="docright">(* a sequence of proposal/reproposal records for the given round/period  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="stv">stv</a></span> : {<span class="id">fmap</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>}; <span class="docright">(* starting value  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="blocks">blocks</a></span> : {<span class="id">fsfun</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> <span class="kwd">with</span> [::]}; <span class="docright">(* a sequence of values seen for the given round  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="softvotes">softvotes</a></span> : {<span class="id">fsfun</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Vote">Vote</a></span> <span class="kwd">with</span> [::]}; <span class="docright">(* a sequence of softvotes seen for the given round/period  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="certvotes">certvotes</a></span> : {<span class="id">fsfun</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Vote">Vote</a></span> <span class="kwd">with</span> [::]}; <span class="docright">(* a sequence of certvotes seen for the given round/period  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="nextvotes_open">nextvotes_open</a></span> : {<span class="id">fsfun</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> <span class="kwd">with</span> [::]}; <span class="docright">(* a sequence of bottom-nextvotes seen for the given round/period/step  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="nextvotes_val">nextvotes_val</a></span> : {<span class="id">fsfun</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Vote">Vote</a></span> <span class="kwd">with</span> [::]} <span class="docright">(* a sequence of value-nextvotes seen for the given round/period/step  *)</span><br/>
&nbsp;&nbsp;&nbsp;}.<br/>
<br/>
#[<span class="id">export</span>] <span class="kwd">Instance</span> <span class="id"><a name="UState_Settable">UState_Settable</a></span> : <span class="id">Settable</span> <span class="id">_</span> :=<br/>
&nbsp;&nbsp;<span class="id">settable</span>! <span class="id"><a href="Algorand.algorand_model.html#mkUState">mkUState</a></span> &lt;<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>;<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>;<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>;<span class="id"><a href="Algorand.algorand_model.html#step">step</a></span>;<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>;<span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span>;<span class="id"><a href="Algorand.algorand_model.html#p_start">p_start</a></span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>;<span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span>;<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>;<span class="id"><a href="Algorand.algorand_model.html#softvotes">softvotes</a></span>;<span class="id"><a href="Algorand.algorand_model.html#certvotes">certvotes</a></span>;<span class="id"><a href="Algorand.algorand_model.html#nextvotes_open">nextvotes_open</a></span>;<span class="id"><a href="Algorand.algorand_model.html#nextvotes_val">nextvotes_val</a></span>&gt;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="codeUState">codeUState</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) :=<br/>
&nbsp;&nbsp;(<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#step">step</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#p_start">p_start</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#softvotes">softvotes</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#certvotes">certvotes</a></span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_open">nextvotes_open</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_val">nextvotes_val</a></span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="decodeUState">decodeUState</a></span> <span class="id">c</span> :=<br/>
<span class="kwd">let</span>: (<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>, <span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>, <span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>, <span class="id"><a href="Algorand.algorand_model.html#step">step</a></span>, <span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>, <span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span>, <span class="id"><a href="Algorand.algorand_model.html#p_start">p_start</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>, <span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span>, <span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>, <span class="id"><a href="Algorand.algorand_model.html#softvotes">softvotes</a></span>, <span class="id"><a href="Algorand.algorand_model.html#certvotes">certvotes</a></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#nextvotes_open">nextvotes_open</a></span>, <span class="id"><a href="Algorand.algorand_model.html#nextvotes_val">nextvotes_val</a></span>) := <span class="id">c</span> <span class="kwd">in</span><br/>
<span class="id"><a href="Algorand.algorand_model.html#mkUState">mkUState</a></span> <span class="id">corrupt</span> <span class="id">round</span> <span class="id">period</span> <span class="id">step</span> <span class="id">timer</span> <span class="id">deadline</span><br/>
&nbsp;<span class="id">p_start</span> <span class="id">proposals</span> <span class="id">stv</span> <span class="id">blocks</span> <span class="id">softvotes</span> <span class="id">certvotes</span><br/>
&nbsp;<span class="id">nextvotes_open</span> <span class="id">nextvotes_val</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cancelUState">cancelUState</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrfun.html#pcancel">pcancel</a></span> <span class="id"><a href="Algorand.algorand_model.html#codeUState">codeUState</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Algorand.algorand_model.html#decodeUState">decodeUState</a></span> <span class="id">x</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof5')">Proof.</span></div>
<div class="proofscript" id="proof5">
 <span class="kwd">by</span> <span class="id">case</span>. Qed.</div>
<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="UState_eqType">UState_eqType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#Equality.Exports.EqType">EqType</a></span> <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#PcanEqMixin">PcanEqMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#cancelUState">cancelUState</a></span>).<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="UState_choiceType">UState_choiceType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#Choice.Exports.ChoiceType">ChoiceType</a></span> <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#PcanChoiceMixin">PcanChoiceMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#cancelUState">cancelUState</a></span>).<br/>
<br/>
<h2> Updating user state </h2>
<br/>
<div class="doc">Update functions for sequences maintained in the user state. </div>
<span class="kwd">Definition</span> <span class="id"><a name="set_proposals">set_proposals</a></span> <span class="id">u</span> <span class="id">r</span>' <span class="id">p</span>' <span class="id">prop</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span> := [<span class="id">fsfun</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">r</span>', <span class="id">p</span>') |-&gt; (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#undup">undup</a></span> (<span class="id">prop</span> :: <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>) (<span class="id">r</span>', <span class="id">p</span>')))] |&gt;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="set_blocks">set_blocks</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) (<span class="id">r</span>':<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) <span class="id">block</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span> := [<span class="id">fsfun</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">r</span>' |-&gt; (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#undup">undup</a></span> (<span class="id">block</span> :: <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>) <span class="id">r</span>'))] |&gt;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="set_softvotes">set_softvotes</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span>' <span class="id">p</span>' <span class="id">sv</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#softvotes">softvotes</a></span> := [<span class="id">fsfun</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#softvotes">softvotes</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">r</span>', <span class="id">p</span>') |-&gt; (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#undup">undup</a></span> (<span class="id">sv</span> :: <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#softvotes">softvotes</a></span>) (<span class="id">r</span>', <span class="id">p</span>')))] |&gt;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="set_certvotes">set_certvotes</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span>' <span class="id">p</span>' <span class="id">sv</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#certvotes">certvotes</a></span> := [<span class="id">fsfun</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#certvotes">certvotes</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">r</span>', <span class="id">p</span>') |-&gt; (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#undup">undup</a></span> (<span class="id">sv</span> :: <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#certvotes">certvotes</a></span>) (<span class="id">r</span>', <span class="id">p</span>')))] |&gt;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="set_nextvotes_open">set_nextvotes_open</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span>' <span class="id">p</span>' <span class="id">s</span>' <span class="id">nvo</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#nextvotes_open">nextvotes_open</a></span> := [<span class="id">fsfun</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_open">nextvotes_open</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">r</span>', <span class="id">p</span>', <span class="id">s</span>') |-&gt; (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#undup">undup</a></span> (<span class="id">nvo</span> :: <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_open">nextvotes_open</a></span>) (<span class="id">r</span>', <span class="id">p</span>', <span class="id">s</span>')))] |&gt;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="set_nextvotes_val">set_nextvotes_val</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span>' <span class="id">p</span>' <span class="id">s</span>' <span class="id">nvv</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#nextvotes_val">nextvotes_val</a></span> := [<span class="id">fsfun</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_val">nextvotes_val</a></span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">r</span>', <span class="id">p</span>', <span class="id">s</span>') |-&gt; (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#undup">undup</a></span> (<span class="id">nvv</span> :: <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_val">nextvotes_val</a></span>) (<span class="id">r</span>', <span class="id">p</span>', <span class="id">s</span>')))] |&gt;.<br/>
<br/>
<div class="doc">Update function for advancing the period of a user state. </div>
<span class="kwd">Definition</span> <span class="id"><a name="advance_period">advance_period</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#period">period</a></span> := (<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>) + 1)%<span class="id">nat</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#step">step</a></span> := 1%<span class="id">nat</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span> := 0%<span class="id">R</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span> := 0%<span class="id">R</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#p_start">p_start</a></span> := (<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#p_start">p_start</a></span>) + <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>))%<span class="id">R</span> |&gt;.<br/>
<br/>
<div class="doc">Update function for advancing the round of a user state. </div>
<span class="kwd">Definition</span> <span class="id"><a name="advance_round">advance_round</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#round">round</a></span> := (<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) + 1)%<span class="id">nat</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#period">period</a></span> := 1%<span class="id">nat</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#step">step</a></span> := 1%<span class="id">nat</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span> := [<span class="id">fmap</span>] |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span> := 0%<span class="id">R</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span> := 0%<span class="id">R</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#p_start">p_start</a></span> := (<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#p_start">p_start</a></span>) + <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>))%<span class="id">R</span> |&gt;.<br/>
<br/>
<h2> Global State </h2>
<br/>
<div class="doc">The structure of the global state. </div>
<span class="kwd">Record</span> <span class="id"><a name="GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">mkGState</span> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="now">now</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>; <span class="docright">(* the current global time value  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="network_partition">network_partition</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span>; <span class="docright">(* a flag indicating whether the network is currently partitioned  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="users">users</a></span> : {<span class="id">fmap</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>}; <span class="docright">(* the global set of users as a finite map of user ids to user states  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="msg_in_transit">msg_in_transit</a></span> : {<span class="id">fmap</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; {<span class="id">mset</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>}}; <span class="docright">(* messages in transit as a finite map from user identifiers (targets) to multisets of messages  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a name="msg_history">msg_history</a></span> : {<span class="id">mset</span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>} <span class="docright">(* the history of all broadcasted messages as a multiset of messages  *)</span><br/>
&nbsp;&nbsp;}.<br/>
<br/>
#[<span class="id">export</span>] <span class="kwd">Instance</span> <span class="id"><a name="GState_Settable">GState_Settable</a></span> : <span class="id">Settable</span> <span class="id">_</span> :=<br/>
&nbsp;<span class="id">settable</span>! <span class="id"><a href="Algorand.algorand_model.html#mkGState">mkGState</a></span> &lt;<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>;<span class="id"><a href="Algorand.algorand_model.html#network_partition">network_partition</a></span>;<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>;<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>;<span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span>&gt;.<br/>
<br/>
<div class="doc">State with empty maps, unpartitioned, at global time 0. </div>
<span class="kwd">Definition</span> <span class="id"><a name="null_state">null_state</a></span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> := <span class="id"><a href="Algorand.algorand_model.html#mkGState">mkGState</a></span> 0%<span class="id">R</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span> [<span class="id">fmap</span>] [<span class="id">fmap</span>] <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.multiset.html#mset0">mset0</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="codeGState">codeGState</a></span> (<span class="id">g</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) :=<br/>
&nbsp;(<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span> <span class="id">g</span>, <span class="id"><a href="Algorand.algorand_model.html#network_partition">network_partition</a></span> <span class="id">g</span>, <span class="id"><a href="Algorand.algorand_model.html#users">users</a></span> <span class="id">g</span>, <span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span> <span class="id">g</span>, <span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span> <span class="id">g</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="decodeGState">decodeGState</a></span> <span class="id">c</span> :=<br/>
<span class="kwd">let</span>: (<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>, <span class="id"><a href="Algorand.algorand_model.html#network_partition">network_partition</a></span>, <span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>, <span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>, <span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span>) := <span class="id">c</span> <span class="kwd">in</span><br/>
<span class="id"><a href="Algorand.algorand_model.html#mkGState">mkGState</a></span> <span class="id">now</span> <span class="id">network_partition</span> <span class="id">users</span> <span class="id">msg_in_transit</span> <span class="id">msg_history</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="cancelGState">cancelGState</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrfun.html#pcancel">pcancel</a></span> <span class="id"><a href="Algorand.algorand_model.html#codeGState">codeGState</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id"><a href="Algorand.algorand_model.html#decodeGState">decodeGState</a></span> <span class="id">x</span>)).<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof6')">Proof.</span></div>
<div class="proofscript" id="proof6">
 <span class="kwd">by</span> <span class="id">case</span>. Qed.</div>
<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="GState_eqType">GState_eqType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#Equality.Exports.EqType">EqType</a></span> <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.eqtype.html#PcanEqMixin">PcanEqMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#cancelGState">cancelGState</a></span>).<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="GState_choiceType">GState_choiceType</a></span> := <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#Choice.Exports.ChoiceType">ChoiceType</a></span> <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#PcanChoiceMixin">PcanChoiceMixin</a></span> <span class="id"><a href="Algorand.algorand_model.html#cancelGState">cancelGState</a></span>).<br/>
<br/>
<div class="doc">Flipping the network partition flag. </div>
<span class="kwd">Definition</span> <span class="id"><a name="flip_partition_flag">flip_partition_flag</a></span> (<span class="id">g</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">g</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#network_partition">network_partition</a></span> := ~~ <span class="id">g</span>.(<span class="id"><a href="Algorand.algorand_model.html#network_partition">network_partition</a></span>) |&gt;.<br/>
<br/>
<h2> Global parameters and axioms of the system </h2>
<br/>
<div class="doc">Small (non-block) message delivery delay. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="lambda">lambda</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>.<br/>
<br/>
<div class="doc">Block message delivery delay. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="big_lambda">big_lambda</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>.<br/>
<br/>
<div class="doc">Recovery time period. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="L">L</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>.<br/>
<br/>
<div class="doc">Axioms on how these bounds are related. </div>
<span class="kwd">Axiom</span> <span class="id"><a name="delays_positive">delays_positive</a></span> : (<span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> &gt; 0)%<span class="id">R</span>.<br/>
<br/>
<span class="kwd">Axiom</span> <span class="id"><a name="delays_order">delays_order</a></span> : (3 * <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> &lt;= <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span> &lt; <span class="id"><a href="Algorand.algorand_model.html#L">L</a></span>)%<span class="id">R</span>.<br/>
<br/>
<div class="doc">Number of soft-votes needed to cert-vote. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="tau_s">tau_s</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
<br/>
<div class="doc">Number of cert-votes needed for a certificate. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="tau_c">tau_c</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="tau_b">tau_b</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
<br/>
<span class="kwd">Parameter</span> <span class="id"><a name="tau_v">tau_v</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>.<br/>
<br/>
<div class="doc">An abstract predicate on values that tells us whether a value is valid. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="valid">valid</a></span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<div class="doc">An abstract predicate on values that tells us whether a
given hash value is indeed the hash of the given block value. </div>
<span class="kwd">Parameter</span> <span class="id"><a name="correct_hash">correct_hash</a></span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<h2> Helper definitions for user-state transitions </h2>
<br/>
<div class="doc">The block has been seen and is valid and the given value is
indeed its hash value. </div>
<span class="kwd">Definition</span> <span class="id"><a name="valid_block_and_hash">valid_block_and_hash</a></span> <span class="id">b</span> <span class="id">v</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid">valid</a></span> <span class="id">b</span> /\ <span class="id"><a href="Algorand.algorand_model.html#correct_hash">correct_hash</a></span> <span class="id">v</span> <span class="id">b</span>.<br/>
<br/>
<div class="doc">From user state, get round-period-step triple. </div>
<span class="kwd">Definition</span> <span class="id"><a name="step_of_ustate">step_of_ustate</a></span> (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) :=<br/>
&nbsp;&nbsp;(<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>), <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#step">step</a></span>)).<br/>
<br/>
<div class="doc">Steps are ordered lexicographically (<span class="bracket"><span class="kwd">Prop</span></span> versions). </div>
<span class="kwd">Definition</span> <span class="id"><a name="step_le">step_le</a></span> (<span class="id">step1</span> <span class="id">step2</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">r1</span>,<span class="id">p1</span>,<span class="id">s1</span>) := <span class="id">step1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">r2</span>,<span class="id">p2</span>,<span class="id">s2</span>) := <span class="id">step2</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">r1</span> &lt; <span class="id">r2</span> \/ <span class="id">r1</span> = <span class="id">r2</span> /\ (<span class="id">p1</span> &lt; <span class="id">p2</span> \/ <span class="id">p1</span> = <span class="id">p2</span> /\ <span class="id">s1</span> &lt;= <span class="id">s2</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="step_lt">step_lt</a></span> (<span class="id">step1</span> <span class="id">step2</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">r1</span>,<span class="id">p1</span>,<span class="id">s1</span>) := <span class="id">step1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">r2</span>,<span class="id">p2</span>,<span class="id">s2</span>) := <span class="id">step2</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">r1</span> &lt; <span class="id">r2</span> \/ <span class="id">r1</span> = <span class="id">r2</span> /\ (<span class="id">p1</span> &lt; <span class="id">p2</span> \/ <span class="id">p1</span> = <span class="id">p2</span> /\ <span class="id">s1</span> &lt; <span class="id">s2</span>).<br/>
<br/>
<div class="doc">Steps are ordered lexicographically (<span class="bracket"><span class="id">bool</span></span> versions). </div>
<span class="kwd">Definition</span> <span class="id"><a name="step_leb">step_leb</a></span> (<span class="id">step1</span> <span class="id">step2</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">r1</span>,<span class="id">p1</span>,<span class="id">s1</span>) := <span class="id">step1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">r2</span>,<span class="id">p2</span>,<span class="id">s2</span>) := <span class="id">step2</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;(<span class="id">r1</span> &lt; <span class="id">r2</span>) || (<span class="id">r1</span> == <span class="id">r2</span>) &amp;&amp; ((<span class="id">p1</span> &lt; <span class="id">p2</span>) || (<span class="id">p1</span> == <span class="id">p2</span>) &amp;&amp; (<span class="id">s1</span> &lt;= <span class="id">s2</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="step_ltb">step_ltb</a></span> (<span class="id">step1</span> <span class="id">step2</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">r1</span>,<span class="id">p1</span>,<span class="id">s1</span>) := <span class="id">step1</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">r2</span>,<span class="id">p2</span>,<span class="id">s2</span>) := <span class="id">step2</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;(<span class="id">r1</span> &lt; <span class="id">r2</span>) || (<span class="id">r1</span> == <span class="id">r2</span>) &amp;&amp; ((<span class="id">p1</span> &lt; <span class="id">p2</span>) || (<span class="id">p1</span> == <span class="id">p2</span>) &amp;&amp; (<span class="id">s1</span> &lt; <span class="id">s2</span>)).<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">us2</span></span> is after <span class="bracket"><span class="id">us1</span></span> if the step of <span class="bracket"><span class="id">us1</span></span> is less than the step of <span class="bracket"><span class="id">us2</span></span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="ustate_after_strict">ustate_after_strict</a></span> <span class="id">us1</span> <span class="id">us2</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#step_lt">step_lt</a></span> (<span class="id"><a href="Algorand.algorand_model.html#step_of_ustate">step_of_ustate</a></span> <span class="id">us1</span>) (<span class="id"><a href="Algorand.algorand_model.html#step_of_ustate">step_of_ustate</a></span> <span class="id">us2</span>).<br/>
<br/>
<div class="doc"><span class="bracket"><span class="id">us2</span></span> is no earlier than <span class="bracket"><span class="id">us1</span></span> in terms of round-period-step ordering. </div>
<span class="kwd">Definition</span> <span class="id"><a name="ustate_after">ustate_after</a></span> <span class="id">us1</span> <span class="id">us2</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">us1</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) &lt; <span class="id">us2</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>)<br/>
&nbsp;&nbsp;\/ (<span class="id">us1</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) = <span class="id">us2</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) /\ <span class="id">us1</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>) &lt; <span class="id">us2</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>))<br/>
&nbsp;&nbsp;\/ (<span class="id">us1</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) = <span class="id">us2</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) /\ <span class="id">us1</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>) = <span class="id">us2</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>) /\ <span class="id">us1</span>.(<span class="id"><a href="Algorand.algorand_model.html#step">step</a></span>) &lt;= <span class="id">us2</span>.(<span class="id"><a href="Algorand.algorand_model.html#step">step</a></span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="msg_step_s">msg_step_s</a></span> (<span class="id">mtype</span> : <span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span>) (<span class="id">v</span> : <span class="id"><a href="Algorand.algorand_model.html#ExValue">ExValue</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">mtype</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span> =&gt; 1<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Proposal">Proposal</a></span> =&gt; 1<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Reproposal">Reproposal</a></span> =&gt; 1<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span> =&gt; 2<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span> =&gt; 3<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#next_val">next_val</a></span> <span class="id">_</span> <span class="id">s</span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; 111<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">v</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#step_val">step_val</a></span> <span class="id">s</span> =&gt; <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; 111<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="msg_step">msg_step</a></span> (<span class="id">msg</span>:<span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> * <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="Algorand.algorand_model.html#msg_round">msg_round</a></span> <span class="id">msg</span>, <span class="id"><a href="Algorand.algorand_model.html#msg_period">msg_period</a></span> <span class="id">msg</span>, <span class="id"><a href="Algorand.algorand_model.html#msg_step_s">msg_step_s</a></span> (<span class="id"><a href="Algorand.algorand_model.html#msg_type">msg_type</a></span> <span class="id">msg</span>) (<span class="id"><a href="Algorand.algorand_model.html#msg_ev">msg_ev</a></span> <span class="id">msg</span>)).<br/>
<br/>
<div class="doc">Is the given message a vote (softvote, certvote, or nextvote) message? </div>
<span class="kwd">Definition</span> <span class="id"><a name="vote_msg">vote_msg</a></span> (<span class="id">msg</span> : <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Algorand.algorand_model.html#msg_type">msg_type</a></span> <span class="id">msg</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span> | <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span> | <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span> | <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#True">True</a></span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Does the given round-period-step match the ones stored in the user state? </div>
<span class="kwd">Definition</span> <span class="id"><a name="valid_rps">valid_rps</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) = <span class="id">r</span> /\ <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>) = <span class="id">p</span> /\ <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#step">step</a></span>) = <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="advancing_rp">advancing_rp</a></span> (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) &lt; <span class="id">r</span> \/ <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) = <span class="id">r</span> /\ <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>) &lt;= <span class="id">p</span>.<br/>
<br/>
<div class="doc">Is the vote <span class="bracket"><span class="id">x</span></span> for this value <span class="bracket"><span class="id">v</span></span>? </div>
<span class="kwd">Definition</span> <span class="id"><a name="matchValue">matchValue</a></span> (<span class="id">x</span> : <span class="id"><a href="Algorand.algorand_model.html#Vote">Vote</a></span>) (<span class="id">v</span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span>: (<span class="id">u</span>', <span class="id">v</span>') := <span class="id">x</span> <span class="kwd">in</span> <span class="id">v</span> == <span class="id">v</span>'.<br/>
<br/>
<div class="doc">The sequence of all values appearing in a given sequence of votes with
duplicates removed. </div>
<span class="kwd">Definition</span> <span class="id"><a name="vote_values">vote_values</a></span> (<span class="id">vs</span>: <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Vote">Vote</a></span>) : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#undup">undup</a></span> [<span class="id">seq</span> <span class="id">x</span>.2 | <span class="id">x</span> &lt;- <span class="id">vs</span>].<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="softvoters_for">softvoters_for</a></span> (<span class="id">v</span>:<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> : {<span class="id">fset</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>} :=<br/>
&nbsp;&nbsp;[<span class="id">fset</span> <span class="id">x</span>.1 | <span class="id">x</span> <span class="kwd">in</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#softvotes">softvotes</a></span>) (<span class="id">r</span>, <span class="id">p</span>) &amp; <span class="id"><a href="Algorand.algorand_model.html#matchValue">matchValue</a></span> <span class="id">x</span> <span class="id">v</span>].<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="nextvoters_open_for">nextvoters_open_for</a></span> (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : {<span class="id">fset</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>} :=<br/>
&nbsp;&nbsp;[<span class="id">fset</span> <span class="id">x</span> <span class="kwd">in</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_open">nextvotes_open</a></span>) (<span class="id">r</span>, <span class="id">p</span>, <span class="id">s</span>)].<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="nextvoters_val_for">nextvoters_val_for</a></span> (<span class="id">v</span>:<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : {<span class="id">fset</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>} :=<br/>
&nbsp;&nbsp;[<span class="id">fset</span> <span class="id">x</span>.1 | <span class="id">x</span> <span class="kwd">in</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_val">nextvotes_val</a></span>) (<span class="id">r</span>, <span class="id">p</span>, <span class="id">s</span>) &amp; <span class="id"><a href="Algorand.algorand_model.html#matchValue">matchValue</a></span> <span class="id">x</span> <span class="id">v</span>].<br/>
<br/>
<div class="doc">The number of softvotes of a given value in a given user state for the round
and period given. Does not use the invariant that <span class="bracket"><span class="id">u</span>.(<span class="id">softvotes</span>) <span class="id">r</span> <span class="id">p</span></span> is duplicate-free. </div>
<span class="kwd">Definition</span> <span class="id"><a name="soft_weight">soft_weight</a></span> (<span class="id">v</span>:<span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#size">size</a></span> (<span class="id"><a href="Algorand.algorand_model.html#softvoters_for">softvoters_for</a></span> <span class="id">v</span> <span class="id">u</span> <span class="id">r</span> <span class="id">p</span>).<br/>
<br/>
<div class="doc">The sequence of values with high enough softvotes in a given user state for given round 
and period, i.e., the sequence of values in softvotes having votes greater than or equal 
to the threshold. Invariant: size is <span class="bracket">&lt;= 1</span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="certvals">certvals</a></span> (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> :=<br/>
&nbsp;&nbsp;[<span class="id">seq</span> <span class="id">v</span> &lt;- <span class="id"><a href="Algorand.algorand_model.html#vote_values">vote_values</a></span> (<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#softvotes">softvotes</a></span>) (<span class="id">r</span>, <span class="id">p</span>)) | (<span class="id"><a href="Algorand.algorand_model.html#soft_weight">soft_weight</a></span> <span class="id">v</span> <span class="id">u</span> <span class="id">r</span> <span class="id">p</span>) &gt;= <span class="id"><a href="Algorand.algorand_model.html#tau_s">tau_s</a></span>].<br/>
<br/>
<div class="doc">The sequence of values certified for in the last period as seen by the given user.
This corresponds to prev_certvals field in the automaton model. </div>
<span class="kwd">Definition</span> <span class="id"><a name="prev_certvals">prev_certvals</a></span> (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">p</span> := <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">p</span> &gt; 1 <span class="kwd">then</span> <span class="id"><a href="Algorand.algorand_model.html#certvals">certvals</a></span> <span class="id">u</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) (<span class="id">p</span> - 1) <span class="kwd">else</span> [::].<br/>
<br/>
<div class="doc">Whether the user has seen enough votes for bottom in the given round-period-step. </div>
<span class="kwd">Definition</span> <span class="id"><a name="nextvote_bottom_quorum">nextvote_bottom_quorum</a></span> (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;#|(<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_open">nextvotes_open</a></span>) (<span class="id">r</span>, <span class="id">p</span>, <span class="id">s</span>))| &gt;= <span class="id"><a href="Algorand.algorand_model.html#tau_b">tau_b</a></span>.<br/>
<br/>
<div class="doc">Whether the user has seen enough nextvotes for a given value in the given round-period-step. </div>
<span class="kwd">Definition</span> <span class="id"><a name="nextvote_value_quorum">nextvote_value_quorum</a></span> (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;#|[<span class="id">seq</span> <span class="id">x</span>.1 | <span class="id">x</span> &lt;- <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#nextvotes_val">nextvotes_val</a></span>) (<span class="id">r</span>, <span class="id">p</span>, <span class="id">s</span>) &amp; <span class="id"><a href="Algorand.algorand_model.html#matchValue">matchValue</a></span> <span class="id">x</span> <span class="id">v</span>]| &gt;= <span class="id"><a href="Algorand.algorand_model.html#tau_v">tau_v</a></span>.<br/>
<br/>
<div class="doc">Whether the user has seen enough nextvotes for some value in the given round-period-step. </div>
<span class="kwd">Definition</span> <span class="id"><a name="nextvote_quorum_for_some_value">nextvote_quorum_for_some_value</a></span> (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">v</span>, <span class="id"><a href="Algorand.algorand_model.html#nextvote_value_quorum">nextvote_value_quorum</a></span> <span class="id">u</span> <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>.<br/>
<br/>
<div class="doc">Whether a quorum for bottom was not seen in the last period
of the current round (for some step during that period). </div>
<span class="kwd">Definition</span> <span class="id"><a name="cert_may_exist">cert_may_exist</a></span> (<span class="id">u</span>:<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">p</span> := <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">r</span> := <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#round">round</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">p</span> &gt; 1 /\ <span class="kwd">forall</span> <span class="id">s</span>, ~ <span class="id"><a href="Algorand.algorand_model.html#nextvote_bottom_quorum">nextvote_bottom_quorum</a></span> <span class="id">u</span> <span class="id">r</span> (<span class="id">p</span> - 1) <span class="id">s</span>.<br/>
<br/>
<div class="doc">Proposal record ordering induced by ordering on credentials. </div>
<span class="kwd">Definition</span> <span class="id"><a name="reclt">reclt</a></span> (<span class="id">rec</span> <span class="id">rec</span>' : <span class="id"><a href="Algorand.algorand_model.html#PropRecord">PropRecord</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> := (<span class="id">rec</span>.1.1.2 &lt; <span class="id">rec</span>'.1.1.2)%<span class="id">O</span>.<br/>
<br/>
<div class="doc">Returns the proposal record in a given sequence of records having the least
credential, i.e., the record of the potential leader. </div>
<span class="kwd">Fixpoint</span> <span class="id"><a name="least_record">least_record</a></span> (<span class="id">prs</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#PropRecord">PropRecord</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="Algorand.algorand_model.html#PropRecord">PropRecord</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">prs</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [::] =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
&nbsp;&nbsp;| [:: <span class="id">rec</span> &amp; <span class="id">prs</span>'] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">least_record</span> <span class="id">prs</span>' <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rec</span>' =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">if</span> <span class="id"><a href="Algorand.algorand_model.html#reclt">reclt</a></span> <span class="id">rec</span>' <span class="id">rec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">then</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rec</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">rec</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Returns whether the given (proposal) value is the potential leader value. </div>
<span class="kwd">Definition</span> <span class="id"><a name="leader_prop_value">leader_prop_value</a></span> (<span class="id">v</span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) (<span class="id">prs</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#PropRecord">PropRecord</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">opr</span> := <span class="id"><a href="Algorand.algorand_model.html#least_record">least_record</a></span> <span class="id">prs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">opr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">_</span>,<span class="id">_</span>, <span class="id">_</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">_</span>,<span class="id">_</span>, <span class="id">v</span>', <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) =&gt; <span class="id">v</span> = <span class="id">v</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Returns whether the given (reproposal) value is the potential leader value. </div>
<span class="kwd">Definition</span> <span class="id"><a name="leader_reprop_value">leader_reprop_value</a></span> (<span class="id">v</span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) (<span class="id">prs</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#PropRecord">PropRecord</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">opr</span> := <span class="id"><a href="Algorand.algorand_model.html#least_record">least_record</a></span> <span class="id">prs</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">opr</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">_</span>,<span class="id">_</span>, <span class="id">_</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>) =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;| <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> (<span class="id">_</span>,<span class="id">_</span>, <span class="id">v</span>', <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>) =&gt; <span class="id">v</span> = <span class="id">v</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">The timer deadline value for the NEXT step following the given step value.
Note that <span class="bracket"><span class="id">k</span></span> is zero-based and hence the apparent difference from the Algorand paper.
The computed deadline values are exactly as given in the paper. </div>
<span class="kwd">Definition</span> <span class="id"><a name="next_deadline">next_deadline</a></span> <span class="id">k</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">k</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| 0 =&gt; 0 <span class="docright">(* deadline for step 1  *)</span><br/>
&nbsp;&nbsp;| 1 =&gt; (2 * <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span>)%<span class="id">R</span> <span class="docright">(* deadline for step 2  *)</span><br/>
&nbsp;&nbsp;| 2 =&gt; (<span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span>)%<span class="id">R</span> <span class="docright">(* deadline for step 3  *)</span><br/>
&nbsp;&nbsp;| <span class="id">n</span> =&gt; (<span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span> + (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#INR">INR</a></span> <span class="id">n</span> - 3) * <span class="id"><a href="Algorand.algorand_model.html#L">L</a></span>)%<span class="id">R</span> <span class="docright">(* deadlines for steps 4, 5, 6, ...  *)</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h2> Step 1: Proposing predicates and user state updates </h2>
<br/>
<div class="doc">The proposal step preconditions. Note that this covers both:
<ul>
<li>
 the case when <span class="bracket"><span class="id">p</span> = 1</span>, and
</li>
<li>
 the case when <span class="bracket"><span class="id">p</span> &gt; 1</span> with the previous period voting for bottom.
</li>
</ul>
Just as in the automaton model, the fact that the last period's quorum
was not for bottom is captured by the predicate <span class="bracket"><span class="id">cert_may_exist</span></span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="propose_ok">propose_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = 0%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 1 /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 1 /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_block_and_hash">valid_block_and_hash</a></span> <span class="id">b</span> <span class="id">v</span> /\<br/>
&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#cert_may_exist">cert_may_exist</a></span> <span class="id">pre</span>.<br/>
<br/>
<div class="doc">The reproposal step preconditions. Note that this is the proposal
step when <span class="bracket"><span class="id">p</span> &gt; 1</span> and a next-vote quorum for a value <span class="bracket"><span class="id">v</span></span> was
seen in <span class="bracket"><span class="id">p</span> - 1</span>. Note also that this may overlap with the case
above, when <span class="bracket"><span class="id">cert_may_exist</span></span> does not hold. </div>
<span class="kwd">Definition</span> <span class="id"><a name="repropose_ok">repropose_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = 0%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 1 /\ <span class="id">p</span> &gt; 1 /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 1 /\<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">s</span>, <span class="id"><a href="Algorand.algorand_model.html#nextvote_value_quorum">nextvote_value_quorum</a></span> <span class="id">pre</span> <span class="id">v</span> <span class="id">r</span> (<span class="id">p</span> - 1) <span class="id">s</span>.<br/>
<br/>
<div class="doc">The no-propose step preconditions.Note that this applies
regardless of whether <span class="bracket"><span class="id">p</span> = 1</span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="no_propose_ok">no_propose_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = 0%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 1 /\<br/>
&nbsp;&nbsp;(<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 1 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#cert_may_exist">cert_may_exist</a></span> <span class="id">pre</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">s</span> <span class="id">v</span>, ~ <span class="id"><a href="Algorand.algorand_model.html#nextvote_value_quorum">nextvote_value_quorum</a></span> <span class="id">pre</span> <span class="id">v</span> <span class="id">r</span> (<span class="id">p</span> - 1) <span class="id">s</span>).<br/>
<br/>
<div class="doc">The proposing step (propose, repropose and nopropose) post-state.
Move on to softvoting and set the new deadline to <span class="bracket">2*<span class="id">lambda</span></span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="propose_result">propose_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span> := (2 * <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span>)%<span class="id">R</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#step">step</a></span> := 2%<span class="id">nat</span> |&gt;.<br/>
<br/>
<h2> Step 2: Softvoting predicates and user state updates </h2>
<br/>
<div class="doc">The Softvoting-a-proposal step preconditions. This covers both:
<ul>
<li>
 the case when <span class="bracket"><span class="id">p</span> = 1</span>, and
</li>
<li>
 the case when <span class="bracket"><span class="id">p</span> &gt; 1</span> with the previous period voting for bottom.
</li>
</ul>
Note that:
<ul>
<li>
 the automaton model has the constraint clock <span class="bracket">&gt;= 2*<span class="id">lambda</span></span>, and
</li>
<li>
 the phrase "<span class="bracket"><span class="id">v</span></span> is a period 1 block" in the Algorand2 description
  is interpreted here as "<span class="bracket"><span class="id">v</span></span> is a reproposal", for simplicity. </li>
</ul>
</div>
<span class="kwd">Definition</span> <span class="id"><a name="softvote_new_ok">softvote_new_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = (2 * <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 2 /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 2 /\<br/>
&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#cert_may_exist">cert_may_exist</a></span> <span class="id">pre</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#leader_prop_value">leader_prop_value</a></span> <span class="id">v</span> (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>) (<span class="id">r</span>, <span class="id">p</span>)) .<br/>
<br/>
<div class="doc">The Softvoting-a-reproposal step preconditions
Note that this is the Softvoting step when <span class="bracket"><span class="id">p</span> &gt; 1</span> and the previous period's
winning vote was for a value <span class="bracket"><span class="id">v</span></span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="softvote_repr_ok">softvote_repr_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">v</span> (<span class="id">r</span> <span class="id">p</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = (2 * <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 2 /\ <span class="id">p</span> &gt; 1 /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 2 /\<br/>
&nbsp;&nbsp;( (~ <span class="id"><a href="Algorand.algorand_model.html#cert_may_exist">cert_may_exist</a></span> <span class="id">pre</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">exists</span> <span class="id">s</span>, <span class="id"><a href="Algorand.algorand_model.html#nextvote_value_quorum">nextvote_value_quorum</a></span> <span class="id">pre</span> <span class="id">v</span> <span class="id">r</span> (<span class="id">p</span> - 1) <span class="id">s</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#leader_reprop_value">leader_reprop_value</a></span> <span class="id">v</span> (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>) (<span class="id">r</span>, <span class="id">p</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;\/ (<span class="id"><a href="Algorand.algorand_model.html#cert_may_exist">cert_may_exist</a></span> <span class="id">pre</span> /\ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span>).[? <span class="id">p</span>] = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>) ).<br/>
<br/>
<div class="doc">The no-softvoting step preconditions. Three reasons a user may
not be able to soft-vote:
<ul>
<li>
 not being in the soft-voting committee, or
</li>
<li>
 not being able to identify a potential leader value to soft-vote for
</li>
<li>
 not seeing enough next-votes for a value reproposed when the previous period
  had a quorum for bottom.
</li>
</ul>
Note that this may apply regardless of whether <span class="bracket"><span class="id">p</span> = 1</span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="no_softvote_ok">no_softvote_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = (2 * <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 2 /\<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;(<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 2 -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(( <span class="id"><a href="Algorand.algorand_model.html#cert_may_exist">cert_may_exist</a></span> <span class="id">pre</span> \/ ~ <span class="id"><a href="Algorand.algorand_model.html#leader_prop_value">leader_prop_value</a></span> <span class="id">v</span> (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>) (<span class="id">r</span>, <span class="id">p</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\ ((<span class="id"><a href="Algorand.algorand_model.html#cert_may_exist">cert_may_exist</a></span> <span class="id">pre</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span>, ~ <span class="id"><a href="Algorand.algorand_model.html#nextvote_value_quorum">nextvote_value_quorum</a></span> <span class="id">pre</span> <span class="id">v</span> <span class="id">r</span> (<span class="id">p</span> - 1) <span class="id">s</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#leader_reprop_value">leader_reprop_value</a></span> <span class="id">v</span> (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#proposals">proposals</a></span>) (<span class="id">r</span>, <span class="id">p</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (~ <span class="id"><a href="Algorand.algorand_model.html#cert_may_exist">cert_may_exist</a></span> <span class="id">pre</span> \/ ~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span>).[? <span class="id">p</span>] = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>)))).<br/>
<br/>
<div class="doc">The softvoting step (new or reproposal) post-state.
We keep the current deadline at <span class="bracket">2 * <span class="id">lambda</span></span> and let certvoting handle
updating the deadline (to avoid timing out while certvoting is already
enabled). This assumes it is ok to certvote at time <span class="bracket">2 * <span class="id">lambda</span></span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="softvote_result">softvote_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#step">step</a></span> := 3 |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span> := (<span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span>)%<span class="id">R</span> |&gt;.<br/>
<br/>
<h2> Step 3: Certvoting predicates and user state updates </h2>
<br/>
<div class="doc">Certvoting step preconditions: the successful case. </div>
<span class="kwd">Definition</span> <span class="id"><a name="certvote_ok">certvote_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> (<span class="id">v</span> <span class="id">b</span>: <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;((2 * <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span>)%<span class="id">R</span> &lt; <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) &lt;= <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 3 /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 3 /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_block_and_hash">valid_block_and_hash</a></span> <span class="id">b</span> <span class="id">v</span> /\<br/>
&nbsp;&nbsp;<span class="id">b</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>) <span class="id">r</span> /\<br/>
&nbsp;&nbsp;<span class="id">v</span> \<span class="kwd">in</span> <span class="id"><a href="Algorand.algorand_model.html#certvals">certvals</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> .<br/>
<br/>
<div class="doc">Certvoting step preconditions: the unsuccessful case - not a committee member. </div>
<span class="kwd">Definition</span> <span class="id"><a name="no_certvote_ok">no_certvote_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;((2 * <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span>)%<span class="id">R</span> &lt; <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) &lt;= <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 3 /\<br/>
&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 3.<br/>
<br/>
<div class="doc">Certvote timeout preconditions. A user timeouts if the deadline
is reached while waiting for some external messages
(i.e., while observing softvotes in step 3) </div>
<span class="kwd">Definition</span> <span class="id"><a name="certvote_timeout_ok">certvote_timeout_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;(<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) &gt;= <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span>))%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> 3 /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> 3 /\<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">b</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;(~ <span class="id"><a href="Algorand.algorand_model.html#valid_block_and_hash">valid_block_and_hash</a></span> <span class="id">b</span> <span class="id">v</span> \/<br/>
&nbsp;&nbsp;&nbsp;~ <span class="id">b</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>) <span class="id">r</span> \/<br/>
&nbsp;&nbsp;&nbsp;~ <span class="id">v</span> \<span class="kwd">in</span> <span class="id"><a href="Algorand.algorand_model.html#certvals">certvals</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span>).<br/>
<br/>
<div class="doc">The certvoting step's resulting user state.
The state update for all certvoting cases: move on to the next step
(the deadline does not need updating). </div>
<span class="kwd">Definition</span> <span class="id"><a name="certvote_result">certvote_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#step">step</a></span> := 4 |&gt;.<br/>
<br/>
<h2> Steps &gt;= 4: Nextvoting predicates and user state updates </h2>
<br/>
<div class="doc">Nextvoting step preconditions, the proper-value case. Note:
<ul>
<li>
 corresponds (roughly) to transition nextvote_val in the automaton
  model (but not the same), and
</li>
<li>
 corresponds more closely to the Algorand2 description (but with the
  committee membership constraint).
</li>
</ul>
</div>
<span class="kwd">Definition</span> <span class="id"><a name="nextvote_val_ok">nextvote_val_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> (<span class="id">v</span> <span class="id">b</span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = (<span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span> + (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#INR">INR</a></span> <span class="id">s</span> - 4) * <span class="id"><a href="Algorand.algorand_model.html#L">L</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;3 &lt; <span class="id">s</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_block_and_hash">valid_block_and_hash</a></span> <span class="id">b</span> <span class="id">v</span> /\<br/>
&nbsp;&nbsp;<span class="id">b</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>) <span class="id">r</span> /\<br/>
&nbsp;&nbsp;<span class="id">v</span> \<span class="kwd">in</span> <span class="id"><a href="Algorand.algorand_model.html#certvals">certvals</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span>.<br/>
<br/>
<div class="doc">Nextvoting step preconditions, the bottom-value case. Note:
<ul>
<li>
 corresponds (roughly) to transition nextvote_open in the automaton
  model (but not the same), and
</li>
<li>
 corresponds more closely to the Algorand2 description (but with the
  committee membership constraint).
</li>
</ul>
</div>
<span class="kwd">Definition</span> <span class="id"><a name="nextvote_open_ok">nextvote_open_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = (<span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span> + (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#INR">INR</a></span> <span class="id">s</span> - 4) * <span class="id"><a href="Algorand.algorand_model.html#L">L</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;3 &lt; <span class="id">s</span> /\<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>, <span class="id">v</span> \<span class="kwd">in</span> <span class="id"><a href="Algorand.algorand_model.html#certvals">certvals</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> -&gt; <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">b</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>) <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="Algorand.algorand_model.html#valid_block_and_hash">valid_block_and_hash</a></span> <span class="id">b</span> <span class="id">v</span>) /\<br/>
&nbsp;&nbsp;(<span class="id">p</span> &gt; 1 -&gt; <span class="id"><a href="Algorand.algorand_model.html#nextvote_bottom_quorum">nextvote_bottom_quorum</a></span> <span class="id">pre</span> <span class="id">r</span> (<span class="id">p</span> - 1) <span class="id">s</span> ).<br/>
<br/>
<div class="doc">Nextvoting step preconditions, the additional special case of using
the starting value. Note:
<ul>
<li>
 this might not be captured in the automaton model, and
</li>
<li>
 corresponds more closely to the Algorand2 description (but with
  additional constraints given explicitly).
</li>
</ul>
</div>
<span class="kwd">Definition</span> <span class="id"><a name="nextvote_stv_ok">nextvote_stv_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = (<span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span> + (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#INR">INR</a></span> <span class="id">s</span> - 4) * <span class="id"><a href="Algorand.algorand_model.html#L">L</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;3 &lt; <span class="id">s</span> /\<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">v</span>, <span class="id">v</span> \<span class="kwd">in</span> <span class="id"><a href="Algorand.algorand_model.html#certvals">certvals</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> -&gt; <span class="kwd">forall</span> <span class="id">b</span>, <span class="id">b</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>) <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~<span class="id"><a href="Algorand.algorand_model.html#valid_block_and_hash">valid_block_and_hash</a></span> <span class="id">b</span> <span class="id">v</span>) /\<br/>
&nbsp;&nbsp;<span class="id">p</span> &gt; 1 /\ ~ <span class="id"><a href="Algorand.algorand_model.html#nextvote_bottom_quorum">nextvote_bottom_quorum</a></span> <span class="id">pre</span> <span class="id">r</span> (<span class="id">p</span> - 1) <span class="id">s</span>.<br/>
<br/>
<div class="doc">Nextvoting step preconditions, the no-voting case. </div>
<span class="kwd">Definition</span> <span class="id"><a name="no_nextvote_ok">no_nextvote_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) = (<span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span> + (<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Raxioms.html#INR">INR</a></span> <span class="id">s</span> - 4) * <span class="id"><a href="Algorand.algorand_model.html#L">L</a></span>)%<span class="id">R</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>.<br/>
<br/>
<div class="doc">Nextvoting step state update for steps <span class="bracket"><span class="id">s</span> &gt;= 4</span> (all cases). </div>
<span class="kwd">Definition</span> <span class="id"><a name="nextvote_result">nextvote_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">s</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#step">step</a></span> :=  (<span class="id">s</span> + 1)%<span class="id">nat</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span> := <span class="id"><a href="Algorand.algorand_model.html#next_deadline">next_deadline</a></span> <span class="id">s</span> |&gt;.<br/>
<br/>
<div class="doc">Advancing period propositions and user state update. </div>
<br/>
<div class="doc">Preconditions, the bottom-value case. Note that this corresponds
to transition advance_period_open in the automaton model. </div>
<span class="kwd">Definition</span> <span class="id"><a name="adv_period_open_ok">adv_period_open_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#nextvote_bottom_quorum">nextvote_bottom_quorum</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>.<br/>
<br/>
<div class="doc">Preconditions, the proper value case. This corresponds to
transition advance_period_val in the automaton model. </div>
<span class="kwd">Definition</span> <span class="id"><a name="adv_period_val_ok">adv_period_val_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) (<span class="id">v</span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_rps">valid_rps</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#nextvote_value_quorum">nextvote_value_quorum</a></span> <span class="id">pre</span> <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>.<br/>
<br/>
<div class="doc">State update, the bottom-value case. </div>
<span class="kwd">Definition</span> <span class="id"><a name="adv_period_open_result">adv_period_open_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="Algorand.algorand_model.html#advance_period">advance_period</a></span> <span class="id">pre</span>) &lt;| <span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span> := <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span>).[~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>).+1] |&gt;.<br/>
<br/>
<div class="doc">State updatem the proper value case. </div>
<span class="kwd">Definition</span> <span class="id"><a name="adv_period_val_result">adv_period_val_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="Algorand.algorand_model.html#advance_period">advance_period</a></span> <span class="id">pre</span>) &lt;| <span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span> := <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span>).[<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#period">period</a></span>).+1 &lt;- <span class="id">v</span>] |&gt;.<br/>
<br/>
<div class="doc">Advancing round predicates and user state updates. Note:
<ul>
<li>
 corresponds to transition certify in the automaton model, and
</li>
<li>
 the requirement <span class="bracket"><span class="id">valid_rps</span></span> has been removed since certification
  may happen at any time.
</li>
</ul>
TODO: need to have some assertion about message age. </div>
<span class="kwd">Definition</span> <span class="id"><a name="certify_ok">certify_ok</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) (<span class="id">v</span> : <span class="id"><a href="Algorand.algorand_model.html#Value">Value</a></span>) <span class="id">r</span> <span class="id">p</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#advancing_rp">advancing_rp</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> /\<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#valid_block_and_hash">valid_block_and_hash</a></span> <span class="id">b</span> <span class="id">v</span> /\<br/>
&nbsp;&nbsp;<span class="id">b</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#blocks">blocks</a></span>) <span class="id">r</span> /\<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#size">size</a></span> [<span class="id">seq</span> <span class="id">x</span> &lt;- <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#certvotes">certvotes</a></span>) (<span class="id">r</span>, <span class="id">p</span>) | <span class="id"><a href="Algorand.algorand_model.html#matchValue">matchValue</a></span> <span class="id">x</span> <span class="id">v</span>] &gt;= <span class="id"><a href="Algorand.algorand_model.html#tau_c">tau_c</a></span>.<br/>
<br/>
<div class="doc">State update. </div>
<span class="kwd">Definition</span> <span class="id"><a name="certify_result">certify_result</a></span> <span class="id">r</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#advance_round">advance_round</a></span> (<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#round">round</a></span> := <span class="id">r</span> |&gt;).<br/>
<br/>
<div class="doc">The post state of delivering a non-vote message. </div>
<span class="kwd">Definition</span> <span class="id"><a name="deliver_nonvote_msg_result">deliver_nonvote_msg_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) (<span class="id">msg</span> : <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) <span class="id">c</span> <span class="id">r</span> <span class="id">p</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">type</span> := <span class="id"><a href="Algorand.algorand_model.html#msg_type">msg_type</a></span> <span class="id">msg</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">id</span> := <span class="id"><a href="Algorand.algorand_model.html#msg_sender">msg_sender</a></span> <span class="id">msg</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ev</span> := <span class="id"><a href="Algorand.algorand_model.html#msg_ev">msg_ev</a></span> <span class="id">msg</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">ev</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">type</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Proposal">Proposal</a></span> =&gt; <span class="id"><a href="Algorand.algorand_model.html#set_proposals">set_proposals</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> (<span class="id">id</span>, <span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Reproposal">Reproposal</a></span> =&gt; <span class="id"><a href="Algorand.algorand_model.html#set_proposals">set_proposals</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> (<span class="id">id</span>, <span class="id">c</span>, <span class="id">v</span>, <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span> =&gt; <span class="id"><a href="Algorand.algorand_model.html#set_blocks">set_blocks</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">pre</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">pre</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<h2> User transition relation - internal transitions </h2>
<br/>
<div class="doc">The internal user-level transition relation type.
An internal transition is a transition that does not consume a message,
and a user transitions from a pre-state into a post-state while emitting
a (possibly empty) sequence of outgoing messages. </div>
<span class="kwd">Definition</span> <span class="id"><a name="u_transition_internal_type">u_transition_internal_type</a></span> := <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> -&gt; (<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> * <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">x</span> # <span class="id">z</span> ~&gt; <span class="id">y</span>" (<span class="kwd">at</span> <span class="id">level</span> 70).<br/>
<br/>
<div class="doc">Internal actions are supposed to take place either:
<ul>
<li>
 at a specific time instance (i.e. never triggered by a recevied message), or
</li>
<li>
 during a time duration, but the preconditions are already satisfied that
  the action fires eagerly at the beginning of that time duration (again,
  without consuming a message).
 </li>
</ul>
</div>
<span class="kwd">Inductive</span> <span class="id"><a name="UTransitionInternal">UTransitionInternal</a></span> : <span class="id"><a href="Algorand.algorand_model.html#u_transition_internal_type">u_transition_internal_type</a></span> :=<br/>
| <span class="id"><a name="propose">propose</a></span> : <span class="docright">(* step 1: block proposal  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#propose_ok">propose_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#propose_result">propose_result</a></span> <span class="id">pre</span>, [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Proposal">Proposal</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">b</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="repropose">repropose</a></span> : <span class="docright">(* step 1: block proposal (reproposal)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#repropose_ok">repropose_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#propose_result">propose_result</a></span> <span class="id">pre</span>, [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Reproposal">Reproposal</a></span> (<span class="id"><a href="Algorand.algorand_model.html#repr_val">repr_val</a></span> <span class="id">v</span> <span class="id">uid</span> <span class="id">p</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="no_propose">no_propose</a></span> : <span class="docright">(* step 1: block proposal (failure)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#no_propose_ok">no_propose_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#propose_result">propose_result</a></span> <span class="id">pre</span>, [::])<br/>
<br/>
| <span class="id"><a name="softvote_new">softvote_new</a></span> : <span class="docright">(* step 2: filtering step (new value)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#softvote_new_ok">softvote_new_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#softvote_result">softvote_result</a></span> <span class="id">pre</span>, [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="softvote_repr">softvote_repr</a></span> : <span class="docright">(* step 2: filtering step (old value)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#softvote_repr_ok">softvote_repr_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#softvote_result">softvote_result</a></span> <span class="id">pre</span>, [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="no_softvote">no_softvote</a></span> : <span class="docright">(* step 2: filtering step (no value)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#no_softvote_ok">no_softvote_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#softvote_result">softvote_result</a></span> <span class="id">pre</span>, [::])<br/>
<br/>
| <span class="id"><a name="certvote1">certvote1</a></span> : <span class="docright">(* step 3: certifying step (success)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#certvote_ok">certvote_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#certvote_result">certvote_result</a></span> <span class="id">pre</span>, [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="no_certvote">no_certvote</a></span> : <span class="docright">(* step 3: certifying step (failure)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#no_certvote_ok">no_certvote_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#certvote_result">certvote_result</a></span> <span class="id">pre</span>, [::])<br/>
<br/>
| <span class="id"><a name="nextvote_val">nextvote_val</a></span> : <span class="docright">(* steps &gt;= 4: finishing step, <span class="bracket"><span class="id">i</span></span> has cert-voted some <span class="bracket"><span class="id">v</span></span>  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#nextvote_val_ok">nextvote_val_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#nextvote_result">nextvote_result</a></span> <span class="id">pre</span> <span class="id">s</span>, [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span> (<span class="id"><a href="Algorand.algorand_model.html#next_val">next_val</a></span> <span class="id">v</span> <span class="id">s</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="nextvote_open">nextvote_open</a></span> : <span class="docright">(* steps &gt;= 4: finishing step, <span class="bracket"><span class="id">i</span></span> has not cert-voted some <span class="bracket"><span class="id">v</span></span>  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#nextvote_open_ok">nextvote_open_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#nextvote_result">nextvote_result</a></span> <span class="id">pre</span> <span class="id">s</span>, [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span> (<span class="id"><a href="Algorand.algorand_model.html#step_val">step_val</a></span> <span class="id">s</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="nextvote_stv">nextvote_stv</a></span> : <span class="docright">(* steps &gt;= 4: finishing step, special case of using <span class="bracket"><span class="id">stv</span></span>  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#nextvote_stv_ok">nextvote_stv_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#stv">stv</a></span>).[? <span class="id">p</span>] = <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#nextvote_result">nextvote_result</a></span> <span class="id">pre</span> <span class="id">s</span>, [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span> (<span class="id"><a href="Algorand.algorand_model.html#next_val">next_val</a></span> <span class="id">v</span> <span class="id">s</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="no_nextvote">no_nextvote</a></span> : <span class="docright">(* steps &gt;= 4: finishing step, no next-voting  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#no_nextvote_ok">no_nextvote_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#nextvote_result">nextvote_result</a></span> <span class="id">pre</span> <span class="id">s</span>, [::])<br/>
<br/>
| <span class="id"><a name="certvote_timeout">certvote_timeout</a></span> : <span class="docright">(* certvote timeout transition, applicable only to step = 3  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#certvote_timeout_ok">certvote_timeout_ok</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">p</span> <span class="id">r</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#certvote_result">certvote_result</a></span> <span class="id">pre</span>, [::])<br/>
<br/>
<span class="kwd">where</span> "<span class="id">x</span> # <span class="id">y</span> ~&gt; <span class="id">z</span>" := (<span class="id"><a href="Algorand.algorand_model.html#UTransitionInternal">UTransitionInternal</a></span> <span class="id">x</span> <span class="id">y</span> <span class="id">z</span>) : <span class="id">type_scope</span>.<br/>
<br/>
<h2> User transition relation - message transitions </h2>
<br/>
<div class="doc">The message-triggered user-level transition relation.
A message-triggered transition consumes an incoming message,
and a user transitions from a pre-state, while consuming a message, into a
post-state and emits a (possibly empty) sequence of outgoing messages. </div>
<span class="kwd">Definition</span> <span class="id"><a name="u_transition_msg_type">u_transition_msg_type</a></span> := <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span> -&gt; (<span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> * <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">a</span> # <span class="id">b</span> ; <span class="id">c</span> ~&gt; <span class="id">d</span>" (<span class="kwd">at</span> <span class="id">level</span> 70).<br/>
<br/>
<div class="doc">Deliver messages and possibly trigger actions urgently.
Note that advancing the period takes precedence over nextvote2_open actions. </div>
<span class="kwd">Inductive</span> <span class="id"><a name="UTransitionMsg">UTransitionMsg</a></span> : <span class="id"><a href="Algorand.algorand_model.html#u_transition_msg_type">u_transition_msg_type</a></span> :=<br/>
| <span class="id"><a name="deliver_softvote">deliver_softvote</a></span> : <span class="docright">(* deliver a softvote while not triggering any internal action  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> <span class="id">v</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pre</span>' := (<span class="id"><a href="Algorand.algorand_model.html#set_softvotes">set_softvotes</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> (<span class="id">i</span>, <span class="id">v</span>)) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#certvote_ok">certvote_ok</a></span> <span class="id">pre</span>' <span class="id">uid</span> <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> ~&gt; (<span class="id">pre</span>', [::])<br/>
<br/>
| <span class="id"><a name="deliver_softvote_certvote1">deliver_softvote_certvote1</a></span> : <span class="docright">(* deliver a softvote and cert-vote for the value (committee member case)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> <span class="id">v</span> <span class="id">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pre</span>' := <span class="id"><a href="Algorand.algorand_model.html#set_softvotes">set_softvotes</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> (<span class="id">i</span>, <span class="id">v</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#certvote_ok">certvote_ok</a></span> <span class="id">pre</span>' <span class="id">uid</span> <span class="id">v</span> <span class="id">b</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#certvote_result">certvote_result</a></span> <span class="id">pre</span>', [:: <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span>])<br/>
<br/>
| <span class="id"><a name="deliver_nextvote_open">deliver_nextvote_open</a></span> : <span class="docright">(* deliver a nextvote for bottom while not triggering any internal action  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pre</span>' := <span class="id"><a href="Algorand.algorand_model.html#set_nextvotes_open">set_nextvotes_open</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> <span class="id">i</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#adv_period_open_ok">adv_period_open_ok</a></span> <span class="id">pre</span>' <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span> (<span class="id"><a href="Algorand.algorand_model.html#step_val">step_val</a></span> <span class="id">s</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> ~&gt; (<span class="id">pre</span>', [::])<br/>
<br/>
| <span class="id"><a name="deliver_nextvote_open_adv_prd">deliver_nextvote_open_adv_prd</a></span> : <span class="docright">(* deliver a nextvote for bottom and advance the period  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pre</span>' := <span class="id"><a href="Algorand.algorand_model.html#set_nextvotes_open">set_nextvotes_open</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> <span class="id">i</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#adv_period_open_ok">adv_period_open_ok</a></span> <span class="id">pre</span>' <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span> (<span class="id"><a href="Algorand.algorand_model.html#step_val">step_val</a></span> <span class="id">s</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#adv_period_open_result">adv_period_open_result</a></span> <span class="id">pre</span>', [::])<br/>
<br/>
| <span class="id"><a name="deliver_nextvote_val">deliver_nextvote_val</a></span> : <span class="docright">(* deliver a nextvote for value while not triggering any internal action  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> <span class="id">i</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pre</span>' := <span class="id"><a href="Algorand.algorand_model.html#set_nextvotes_val">set_nextvotes_val</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> (<span class="id">i</span>, <span class="id">v</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#adv_period_val_ok">adv_period_val_ok</a></span> <span class="id">pre</span>' <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span> (<span class="id"><a href="Algorand.algorand_model.html#next_val">next_val</a></span> <span class="id">v</span> <span class="id">s</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> ~&gt; (<span class="id">pre</span>', [::])<br/>
<br/>
| <span class="id"><a name="deliver_nextvote_val_adv_prd">deliver_nextvote_val_adv_prd</a></span> : <span class="docright">(* deliver a nextvote for value and advance the period  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> <span class="id">i</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pre</span>' := <span class="id"><a href="Algorand.algorand_model.html#set_nextvotes_val">set_nextvotes_val</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> (<span class="id">i</span>, <span class="id">v</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#adv_period_val_ok">adv_period_val_ok</a></span> <span class="id">pre</span>' <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span> (<span class="id"><a href="Algorand.algorand_model.html#next_val">next_val</a></span> <span class="id">v</span> <span class="id">s</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#adv_period_val_result">adv_period_val_result</a></span> <span class="id">pre</span>' <span class="id">v</span>, [::])<br/>
<br/>
| <span class="id"><a name="deliver_certvote">deliver_certvote</a></span> : <span class="docright">(* deliver a certvote while not triggering any internal action  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pre</span>' := <span class="id"><a href="Algorand.algorand_model.html#set_certvotes">set_certvotes</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> (<span class="id">i</span>, <span class="id">v</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#certify_ok">certify_ok</a></span> <span class="id">pre</span>' <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> ~&gt; (<span class="id">pre</span>', [::])<br/>
<br/>
| <span class="id"><a name="deliver_certvote_adv_rnd">deliver_certvote_adv_rnd</a></span> : <span class="docright">(* deliver a certvote for value and advance the round  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> <span class="id">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">pre</span>' := <span class="id"><a href="Algorand.algorand_model.html#set_certvotes">set_certvotes</a></span> <span class="id">pre</span> <span class="id">r</span> <span class="id">p</span> (<span class="id">i</span>, <span class="id">v</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#certify_ok">certify_ok</a></span> <span class="id">pre</span>' <span class="id">v</span> <span class="id">r</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span> (<span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">v</span>) <span class="id">r</span> <span class="id">p</span> <span class="id">i</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#certify_result">certify_result</a></span> <span class="id">r</span> <span class="id">pre</span>', [::])<br/>
<div class="doc">Note that some Algorand documents say this transition may try to
send another certvote message from this node, but we have been
informed that the implementation does not do this,
and allowing it would complicated proofs. </div>
| <span class="id"><a name="deliver_nonvote_msg">deliver_nonvote_msg</a></span> : <span class="docright">(* deliver a message other than vote messages (i.e., <span class="bracket"><span class="id">Block</span></span>, <span class="bracket"><span class="id">Proposal</span></span>, or <span class="bracket"><span class="id">Reproposal</span></span>)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">uid</span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) <span class="id">msg</span> <span class="id">c</span> <span class="id">r</span> <span class="id">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id"><a href="Algorand.algorand_model.html#vote_msg">vote_msg</a></span> <span class="id">msg</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span> ; <span class="id">msg</span> ~&gt; (<span class="id"><a href="Algorand.algorand_model.html#deliver_nonvote_msg_result">deliver_nonvote_msg_result</a></span> <span class="id">pre</span> <span class="id">msg</span> <span class="id">c</span> <span class="id">r</span> <span class="id">p</span>, [::])<br/>
<br/>
<span class="kwd">where</span> "<span class="id">a</span> # <span class="id">b</span> ; <span class="id">c</span> ~&gt; <span class="id">d</span>" := (<span class="id"><a href="Algorand.algorand_model.html#UTransitionMsg">UTransitionMsg</a></span> <span class="id">a</span> <span class="id">b</span> <span class="id">c</span> <span class="id">d</span>) : <span class="id">type_scope</span>.<br/>
<br/>
<h2> Helper functions for global transitions </h2>
<br/>
<div class="doc">Is the network in a partitioned/unpartitioned state? </div>
<span class="kwd">Definition</span> <span class="id"><a name="is_partitioned">is_partitioned</a></span> <span class="id">pre</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> := <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#network_partition">network_partition</a></span>).<br/>
<span class="kwd">Definition</span> <span class="id"><a name="is_unpartitioned">is_unpartitioned</a></span> <span class="id">pre</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> := ~~ <span class="id"><a href="Algorand.algorand_model.html#is_partitioned">is_partitioned</a></span> <span class="id">pre</span>.<br/>
<br/>
<div class="doc">It is OK to advance time if:
<ul>
<li>
 the user is corrupt (its deadline is irrelevant), or
</li>
<li>
 the increment does not go beyond the deadline. </li>
</ul>
</div>
<span class="kwd">Definition</span> <span class="id"><a name="user_can_advance_timer">user_can_advance_timer</a></span> (<span class="id">increment</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#posreal">posreal</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrbool.html#pred">pred</a></span> <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">u</span> =&gt; <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>) || <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.analysis.Rstruct.html#Rleb">Rleb</a></span> (<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) + <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#pos">pos</a></span> <span class="id">increment</span>) <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span>).<br/>
<br/>
<div class="doc">Advance the timer of an honest user (timers of corrupt users are irrelevant). </div>
<span class="kwd">Definition</span> <span class="id"><a name="user_advance_timer">user_advance_timer</a></span> (<span class="id">increment</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#posreal">posreal</a></span>) (<span class="id">u</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> ~~ <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>)<br/>
&nbsp;&nbsp;<span class="kwd">then</span> <span class="id">u</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span> := (<span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#timer">timer</a></span>) + <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#pos">pos</a></span> <span class="id">increment</span>)%<span class="id">R</span> |&gt;<br/>
&nbsp;&nbsp;<span class="kwd">else</span> <span class="id">u</span>.<br/>
<br/>
<div class="doc">Is it OK to advance timers of all (honest) users by the given increment? </div>
<span class="kwd">Definition</span> <span class="id"><a name="tick_ok_users">tick_ok_users</a></span> <span class="id">increment</span> (<span class="id">pre</span>:<span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.fmap_ext.html#allf">allf</a></span> (<span class="id"><a href="Algorand.algorand_model.html#user_can_advance_timer">user_can_advance_timer</a></span> <span class="id">increment</span>) <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).<br/>
<br/>
<div class="doc">It is OK to advance time if:
<ul>
<li>
 the network is partitioned (message delivery delays are ignored), or
</li>
<li>
 the time increment does not cause missing a message delivery deadline.
 </li>
</ul>
</div>
<span class="kwd">Definition</span> <span class="id"><a name="tick_ok_msgs">tick_ok_msgs</a></span> (<span class="id">increment</span>:<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#posreal">posreal</a></span>) (<span class="id">pre</span>:<span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#is_partitioned">is_partitioned</a></span> <span class="id">pre</span> ||<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">target_time</span> := (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>) + <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#pos">pos</a></span> <span class="id">increment</span>)%<span class="id">R</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;\<span class="id">big</span>[<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb">andb</a></span>/<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>]<span class="id">_</span>(<span class="id">user_msgs</span> &lt;- <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.finmap.html#codomf">codomf</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>))<br/>
&nbsp;&nbsp;&nbsp;\<span class="id">big</span>[<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#andb">andb</a></span>/<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span>]<span class="id">_</span>(<span class="id">m</span> &lt;- (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.multiset.html#enum_mset">enum_mset</a></span> <span class="id">user_msgs</span>)) <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.analysis.Rstruct.html#Rleb">Rleb</a></span> <span class="id">target_time</span> (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">m</span>).<br/>
<br/>
<div class="doc">Returns whether time may advance, taking into consideration the state of
the network, users, their deadlines and message deadlines. </div>
<span class="kwd">Definition</span> <span class="id"><a name="tick_ok">tick_ok</a></span> (<span class="id">increment</span>:<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#posreal">posreal</a></span>) (<span class="id">pre</span>:<span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#tick_ok_users">tick_ok_users</a></span> <span class="id">increment</span> <span class="id">pre</span> &amp;&amp; <span class="id"><a href="Algorand.algorand_model.html#tick_ok_msgs">tick_ok_msgs</a></span> <span class="id">increment</span> <span class="id">pre</span>.<br/>
<br/>
<div class="doc">Advance all (honest) user timers by the given increment. </div>
<span class="kwd">Definition</span> <span class="id"><a name="tick_users">tick_users</a></span> <span class="id">increment</span> <span class="id">pre</span> : {<span class="id">fmap</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>} :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.fmap_ext.html#updf">updf</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>) (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.finmap.html#domf">domf</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) (<span class="kwd">fun</span> <span class="id">_</span> <span class="id">us</span> =&gt; <span class="id"><a href="Algorand.algorand_model.html#user_advance_timer">user_advance_timer</a></span> <span class="id">increment</span> <span class="id">us</span>).<br/>
<br/>
<div class="doc">Computes the global state after advancing time with the given increment. </div>
<span class="kwd">Definition</span> <span class="id"><a name="tick_update">tick_update</a></span> <span class="id">increment</span> <span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#now">now</a></span> := (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>) + <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#pos">pos</a></span> <span class="id">increment</span>)%<span class="id">R</span> |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#users">users</a></span> := <span class="id"><a href="Algorand.algorand_model.html#tick_users">tick_users</a></span> <span class="id">increment</span> <span class="id">pre</span> |&gt;.<br/>
<br/>
<div class="doc">Computes the standard deadline of a message based on its type. </div>
<span class="kwd">Definition</span> <span class="id"><a name="msg_deadline">msg_deadline</a></span> (<span class="id">msg</span> : <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) <span class="id">now</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="Algorand.algorand_model.html#msg_type">msg_type</a></span> <span class="id">msg</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span> =&gt; (<span class="id">now</span> + <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span> + <span class="id"><a href="Algorand.algorand_model.html#big_lambda">big_lambda</a></span>)%<span class="id">R</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; (<span class="id">now</span> + <span class="id"><a href="Algorand.algorand_model.html#lambda">lambda</a></span>)%<span class="id">R</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="merge_msgs_deadline">merge_msgs_deadline</a></span> (<span class="id">now</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">msgs</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) (<span class="id">v</span> : {<span class="id">mset</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>}) : {<span class="id">mset</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>} :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.multiset.html#seq_mset">seq_mset</a></span> [<span class="id">seq</span> (<span class="id"><a href="Algorand.algorand_model.html#msg_deadline">msg_deadline</a></span> <span class="id">msg</span> <span class="id">now</span>,<span class="id">msg</span>) | <span class="id">msg</span> &lt;- <span class="id">msgs</span>] `+` <span class="id">v</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="send_broadcasts_def">send_broadcasts_def</a></span> (<span class="id">now</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span>) (<span class="id">targets</span> : {<span class="id">fset</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>}) (<span class="id">prev_msgs</span> : <span class="id"><a href="Algorand.algorand_model.html#MsgPool">MsgPool</a></span>) (<span class="id">msgs</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#MsgPool">MsgPool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.fmap_ext.html#updf">updf</a></span> <span class="id">prev_msgs</span> <span class="id">targets</span> (<span class="kwd">fun</span> <span class="id">_</span> =&gt; <span class="id"><a href="Algorand.algorand_model.html#merge_msgs_deadline">merge_msgs_deadline</a></span> <span class="id">now</span> <span class="id">msgs</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="send_broadcasts_key">send_broadcasts_key</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof7')">Proof.</span></div>
<div class="proofscript" id="proof7">
 <span class="id">exact</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>. Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="send_broadcasts">send_broadcasts</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssreflect.html#locked_with">locked_with</a></span> <span class="id"><a href="Algorand.algorand_model.html#send_broadcasts_key">send_broadcasts_key</a></span> <span class="id"><a href="Algorand.algorand_model.html#send_broadcasts_def">send_broadcasts_def</a></span>.<br/>
<span class="kwd">Canonical</span> <span class="id"><a name="send_broadcasts_unlockable">send_broadcasts_unlockable</a></span> := [<span class="id">unlockable</span> <span class="kwd">fun</span> <span class="id"><a href="Algorand.algorand_model.html#send_broadcasts">send_broadcasts</a></span>].<br/>
<br/>
<div class="doc">Returns <span class="bracket"><span class="id">true</span></span> if <span class="bracket"><span class="id">P</span></span> is true at nth element in path <span class="bracket"><span class="id">p</span></span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="at_step">at_step</a></span> <span class="id">n</span> (<span class="id">p</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) (<span class="id">P</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrbool.html#pred">pred</a></span> <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#drop">drop</a></span> <span class="id">n</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">g</span> :: <span class="id">_</span> =&gt; <span class="id">P</span> <span class="id">g</span><br/>
&nbsp;&nbsp;| [::] =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Returns <span class="bracket"><span class="id">true</span></span> if the given user id is found in the map and the user state
corresponding to that id is for a corrupt user. </div>
<span class="kwd">Definition</span> <span class="id"><a name="is_user_corrupt">is_user_corrupt</a></span> (<span class="id">uid</span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>) (<span class="id">users</span> : {<span class="id">fmap</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>}) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">users</span>.[? <span class="id">uid</span>] <span class="id">is</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">u</span> <span class="kwd">then</span> <span class="id">u</span>.(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>) <span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="is_user_corrupt_gstate">is_user_corrupt_gstate</a></span> (<span class="id">uid</span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>) (<span class="id">g</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#is_user_corrupt">is_user_corrupt</a></span> <span class="id">uid</span> (<span class="id">g</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="user_honest">user_honest</a></span> (<span class="id">uid</span>:<span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>) (<span class="id">g</span>:<span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">g</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[? <span class="id">uid</span>] <span class="id">is</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">ustate</span> <span class="kwd">then</span> ~~ (<span class="id">ustate</span>.(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>)) <span class="kwd">else</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#false">false</a></span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="user_honest_at">user_honest_at</a></span> <span class="id">ix</span> <span class="id">p</span> (<span class="id">uid</span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#bool">bool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#at_step">at_step</a></span> <span class="id">ix</span> <span class="id">p</span> (<span class="id"><a href="Algorand.algorand_model.html#user_honest">user_honest</a></span> <span class="id">uid</span>).<br/>
<br/>
<div class="doc">Returns the given users map restricted to honest users only. </div>
<span class="kwd">Definition</span> <span class="id"><a name="honest_users">honest_users</a></span> (<span class="id">users</span> : {<span class="id">fmap</span> <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span>}) :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">corrupt_ids</span> := [<span class="id">fset</span> <span class="id">x</span> <span class="kwd">in</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.finmap.html#domf">domf</a></span> <span class="id">users</span> | <span class="id"><a href="Algorand.algorand_model.html#is_user_corrupt">is_user_corrupt</a></span> <span class="id">x</span> <span class="id">users</span>] <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">users</span>.[\ <span class="id">corrupt_ids</span>].<br/>
<br/>
<div class="doc">Computes the global state after a message delivery, given the result of the
user transition and the messages sent out. Note:
<ul>
<li>
 the delivered message is removed from the user's mailbox, and
</li>
<li>
 broadcasts new messages to honest users only.
 </li>
</ul>
</div>
<span class="kwd">Definition</span> <span class="id"><a name="delivery_result">delivery_result</a></span> <span class="id">pre</span> <span class="id">uid</span> (<span class="id">uid_has_mailbox</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>)) <span class="id">delivered</span> <span class="id">ustate_post</span> (<span class="id">sent</span>: <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">users</span>' := <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">uid</span> &lt;- <span class="id">ustate_post</span>] <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">user_msgs</span>' := (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>).[<span class="id">uid_has_mailbox</span>] `\ <span class="id">delivered</span>)%<span class="id">mset</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgs</span>' := <span class="id"><a href="Algorand.algorand_model.html#send_broadcasts">send_broadcasts</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>) (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.finmap.html#domf">domf</a></span> (<span class="id"><a href="Algorand.algorand_model.html#honest_users">honest_users</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) `\ <span class="id">uid</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>).[<span class="id">uid</span> &lt;- <span class="id">user_msgs</span>'] <span class="id">sent</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgh</span>' := (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span>) `+` (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.multiset.html#seq_mset">seq_mset</a></span> <span class="id">sent</span>))%<span class="id">mset</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#users">users</a></span> := <span class="id">users</span>' |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span> := <span class="id">msgs</span>' |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span> := <span class="id">msgh</span>' |&gt;.<br/>
<br/>
<span class="kwd">Arguments</span> <span class="id"><a href="Algorand.algorand_model.html#delivery_result">delivery_result</a></span> : <span class="id">clear</span> <span class="id">implicits</span>.<br/>
<br/>
<div class="doc">Computes the global state after an internal user-level transition
given the result of the user transition and the messages sent out. </div>
<span class="kwd">Definition</span> <span class="id"><a name="step_result">step_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">ustate_post</span> (<span class="id">sent</span>: <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">users</span>' := <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">uid</span> &lt;- <span class="id">ustate_post</span>] <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgs</span>' := <span class="id"><a href="Algorand.algorand_model.html#send_broadcasts">send_broadcasts</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>) (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.finmap.html#domf">domf</a></span> (<span class="id"><a href="Algorand.algorand_model.html#honest_users">honest_users</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) `\ <span class="id">uid</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>) <span class="id">sent</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgh</span>' := (<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span>)  `+` (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.multiset.html#seq_mset">seq_mset</a></span> <span class="id">sent</span>))%<span class="id">mset</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#users">users</a></span> := <span class="id">users</span>' |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span> := <span class="id">msgs</span>' |&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;| <span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span> := <span class="id">msgh</span>'  |&gt;.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="new_deadline">new_deadline</a></span> <span class="id">now</span> <span class="id">cur_deadline</span> <span class="id">msg</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">max_deadline</span> := <span class="id"><a href="Algorand.algorand_model.html#msg_deadline">msg_deadline</a></span> <span class="id">msg</span> <span class="id">now</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rbasic_fun.html#Rmax">Rmax</a></span> <span class="id">cur_deadline</span> <span class="id">max_deadline</span>.<br/>
<br/>
<div class="doc">Resets the deadline of a message having a missed deadline. </div>
<span class="kwd">Definition</span> <span class="id"><a name="reset_deadline">reset_deadline</a></span> <span class="id">now</span> (<span class="id">msg</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span> :=<br/>
&nbsp;&nbsp;(<span class="id"><a href="Algorand.algorand_model.html#new_deadline">new_deadline</a></span> <span class="id">now</span> <span class="id">msg</span>.1 <span class="id">msg</span>.2, <span class="id">msg</span>.2).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="map_mset">map_mset</a></span> {<span class="id">A</span> <span class="id">B</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.choice.html#Choice.Exports.choiceType">choiceType</a></span>} (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>) (<span class="id">m</span> : {<span class="id">mset</span> <span class="id">A</span>}) : {<span class="id">mset</span> <span class="id">B</span>} :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.multiset.html#seq_mset">seq_mset</a></span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#map">map</a></span> <span class="id">f</span> <span class="id">m</span>).<br/>
<br/>
<div class="doc">Recursively resets message deadlines of all the messages given. </div>
<span class="kwd">Definition</span> <span class="id"><a name="reset_user_msg_delays">reset_user_msg_delays</a></span> <span class="id">msgs</span> <span class="id">now</span> : {<span class="id">mset</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>} :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#map_mset">map_mset</a></span> (<span class="id"><a href="Algorand.algorand_model.html#reset_deadline">reset_deadline</a></span> <span class="id">now</span>) <span class="id">msgs</span>.<br/>
<br/>
<div class="doc">Constructs a message pool with all messages having missed delivery deadlines
updated appropriately based on the message type. </div>
<span class="kwd">Definition</span> <span class="id"><a name="reset_msg_delays">reset_msg_delays</a></span> (<span class="id">msgpool</span> : <span class="id"><a href="Algorand.algorand_model.html#MsgPool">MsgPool</a></span>) <span class="id">now</span> : <span class="id"><a href="Algorand.algorand_model.html#MsgPool">MsgPool</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.fmap_ext.html#updf">updf</a></span> <span class="id">msgpool</span> (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.finmap.html#domf">domf</a></span> <span class="id">msgpool</span>) (<span class="kwd">fun</span> <span class="id">_</span> <span class="id">msgs</span> =&gt; <span class="id"><a href="Algorand.algorand_model.html#reset_user_msg_delays">reset_user_msg_delays</a></span> <span class="id">msgs</span> <span class="id">now</span>).<br/>
<br/>
<div class="doc">Postpones the deadline of a message (extending its delivery delay). </div>
<span class="kwd">Definition</span> <span class="id"><a name="extend_deadline">extend_deadline</a></span> <span class="id">r</span> (<span class="id">msgs</span> : {<span class="id">mset</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>}) (<span class="id">msg</span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) : {<span class="id">mset</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> * <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>} :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ext_deadline</span> := (<span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#fst">fst</a></span> <span class="id">msg</span> + <span class="id">r</span>)%<span class="id">R</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;(<span class="id">msgs</span> `+` [<span class="id">mset</span> (<span class="id">ext_deadline</span>, <span class="id">msg</span>.2)])%<span class="id">mset</span>.<br/>
<br/>
<div class="doc">Computes the state resulting from getting partitioned.
Note that this no longer injects extended message delays (see the <span class="bracket"><span class="id">tick</span></span> rule). </div>
<span class="kwd">Definition</span> <span class="id"><a name="make_partitioned">make_partitioned</a></span> (<span class="id">pre</span>:<span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#flip_partition_flag">flip_partition_flag</a></span> <span class="id">pre</span>.<br/>
<br/>
<div class="doc">Computes the state resulting from recovering from a partition. </div>
<span class="kwd">Definition</span> <span class="id"><a name="recover_from_partitioned">recover_from_partitioned</a></span> <span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgpool</span>' := <span class="id"><a href="Algorand.algorand_model.html#reset_msg_delays">reset_msg_delays</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>) <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;(<span class="id"><a href="Algorand.algorand_model.html#flip_partition_flag">flip_partition_flag</a></span> <span class="id">pre</span>) &lt;| <span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span> := <span class="id">msgpool</span>' |&gt;.<br/>
<br/>
<div class="doc">Marks a user state corrupted by setting the corrupt flag. </div>
<span class="kwd">Definition</span> <span class="id"><a name="make_corrupt">make_corrupt</a></span> <span class="id">ustate</span> : <span class="id"><a href="Algorand.algorand_model.html#UState">UState</a></span> :=<br/>
&nbsp;&nbsp;<span class="id">ustate</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#true">true</a></span> |&gt;.<br/>
<br/>
<div class="doc">Drop the set of messages targeted for a specific user from the given
message map. </div>
<span class="kwd">Definition</span> <span class="id"><a name="drop_mailbox_of_user">drop_mailbox_of_user</a></span> <span class="id">uid</span> (<span class="id">msgs</span> : <span class="id"><a href="Algorand.algorand_model.html#MsgPool">MsgPool</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#MsgPool">MsgPool</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">if</span> <span class="id">msgs</span>.[? <span class="id">uid</span>] <span class="id">is</span> <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">mailbox</span> <span class="kwd">then</span> <span class="id">msgs</span>.[<span class="id">uid</span> &lt;- <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.multiset.html#mset0">mset0</a></span>] <span class="kwd">else</span> <span class="id">msgs</span>.<br/>
<br/>
<div class="doc">Computes the state resulting from corrupting a user.
The user will have its corrupt flag (in its local state) set to <span class="bracket"><span class="id">true</span></span>
and his mailbox in the global state removed. </div>
<span class="kwd">Definition</span> <span class="id"><a name="corrupt_user_result">corrupt_user_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) (<span class="id">uid</span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>)<br/>
&nbsp;(<span class="id">ustate_key</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">ustate</span>' := <span class="id"><a href="Algorand.algorand_model.html#make_corrupt">make_corrupt</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">ustate_key</span>] <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgs</span>' := <span class="id"><a href="Algorand.algorand_model.html#drop_mailbox_of_user">drop_mailbox_of_user</a></span> <span class="id">uid</span>  <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">users</span>' := <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">uid</span> &lt;- <span class="id">ustate</span>'] <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#users">users</a></span> := <span class="id">users</span>' |&gt; &lt;| <span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span> := <span class="id">msgs</span>' |&gt;.<br/>
<br/>
<div class="doc">Computes the state resulting from replaying a message to a user.
The message is replayed to the given target user and added to his mailbox.
It is not broadcast because other users have already seen the original. </div>
<span class="kwd">Definition</span> <span class="id"><a name="replay_msg_result">replay_msg_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) (<span class="id">uid</span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>) (<span class="id">msg</span> : <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span>) : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgs</span>' := <span class="id"><a href="Algorand.algorand_model.html#send_broadcasts">send_broadcasts</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>) [<span class="id">fset</span> <span class="id">uid</span>] <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>) [:: <span class="id">msg</span>] <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span> := <span class="id">msgs</span>' |&gt;.<br/>
<br/>
<div class="doc">Does the adversary have the keys of the user for the given r-p-s?
The adversary will have the keys if the user is corrupt and the given
r-p-s comes after (or is equal to) the r-p-s of the user. </div>
<span class="kwd">Definition</span> <span class="id"><a name="have_keys">have_keys</a></span> <span class="id">ustate</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">ustate</span>.(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>) /\ <span class="id"><a href="Algorand.algorand_model.html#step_le">step_le</a></span> (<span class="id"><a href="Algorand.algorand_model.html#step_of_ustate">step_of_ustate</a></span> <span class="id">ustate</span>) (<span class="id">r</span>,<span class="id">p</span>,<span class="id">s</span>).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="mtype_matches_step">mtype_matches_step</a></span> <span class="id">mtype</span> <span class="id">mval</span> <span class="id">s</span> : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">mtype</span>, <span class="id">mval</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Block">Block</a></span>, <span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">_</span> | <span class="id"><a href="Algorand.algorand_model.html#Proposal">Proposal</a></span>, <span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">_</span> | <span class="id"><a href="Algorand.algorand_model.html#Reproposal">Reproposal</a></span>, <span class="id"><a href="Algorand.algorand_model.html#repr_val">repr_val</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> =&gt; <span class="id">s</span> = 1<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Softvote">Softvote</a></span>, <span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">_</span> =&gt; <span class="id">s</span> = 2<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Certvote">Certvote</a></span>, <span class="id"><a href="Algorand.algorand_model.html#val">val</a></span> <span class="id">_</span> =&gt; <span class="id">s</span> = 3<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Open">Nextvote_Open</a></span>, <span class="id"><a href="Algorand.algorand_model.html#step_val">step_val</a></span> <span class="id">s</span>' =&gt; <span class="id">s</span> = <span class="id">s</span>'<br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#Nextvote_Val">Nextvote_Val</a></span>, <span class="id"><a href="Algorand.algorand_model.html#next_val">next_val</a></span> <span class="id">_</span> <span class="id">s</span>' =&gt; <span class="id">s</span> = <span class="id">s</span>'<br/>
&nbsp;&nbsp;| <span class="id">_</span>, <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Computes the state resulting from forging a message to a user.
The message is first created and then queued at the target user's mailbox </div>
<span class="kwd">Definition</span> <span class="id"><a name="forge_msg_result">forge_msg_result</a></span> (<span class="id">pre</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) (<span class="id">uid</span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span>) <span class="id">r</span> <span class="id">p</span> <span class="id">mtype</span> <span class="id">mval</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msg</span> := <span class="id"><a href="Algorand.algorand_model.html#mkMsg">mkMsg</a></span> <span class="id">mtype</span> <span class="id">mval</span> <span class="id">r</span> <span class="id">p</span> <span class="id">uid</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">msgs</span>' := <span class="id"><a href="Algorand.algorand_model.html#send_broadcasts">send_broadcasts</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#now">now</a></span>) (<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.finmap.finmap.html#domf">domf</a></span> (<span class="id"><a href="Algorand.algorand_model.html#honest_users">honest_users</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>) [:: <span class="id">msg</span>] <span class="kwd">in</span><br/>
&nbsp;&nbsp;<span class="id">pre</span> &lt;| <span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span> := <span class="id">msgs</span>' |&gt;.<br/>
<br/>
<h2> Global transition relation </h2>
<br/>
<div class="doc">Global transition relation type. </div>
<span class="kwd">Definition</span> <span class="id"><a name="g_transition_type">g_transition_type</a></span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Relations.Relation_Definitions.html#relation">relation</a></span> <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>.<br/>
<br/>
<span class="kwd">Reserved</span> <span class="kwd">Notation</span> "<span class="id">x</span> ~~&gt; <span class="id">y</span>" (<span class="kwd">at</span> <span class="id">level</span> 90).<br/>
<br/>
<div class="doc">Note that corrupt user deadlines are ignored, and
when partitioned, message delivery delays are ignored.
This means that the adversary action to inject extended
message delays is modeled by <span class="bracket"><span class="id">step_tick</span></span> ignoring message
delivery deadlines when partitioned. </div>
<span class="kwd">Inductive</span> <span class="id"><a name="GTransition">GTransition</a></span> : <span class="id"><a href="Algorand.algorand_model.html#g_transition_type">g_transition_type</a></span> :=<br/>
| <span class="id"><a name="step_tick">step_tick</a></span> : <span class="docright">(* advance the global time  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">increment</span> <span class="id">pre</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#tick_ok">tick_ok</a></span> <span class="id">increment</span> <span class="id">pre</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> ~~&gt; <span class="id"><a href="Algorand.algorand_model.html#tick_update">tick_update</a></span> <span class="id">increment</span> <span class="id">pre</span><br/>
<br/>
| <span class="id"><a name="step_deliver_msg">step_deliver_msg</a></span> : <span class="docright">(* deliver a message to a user (honest users only)  *)</span><br/>
&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pre</span> <span class="id">uid</span> (<span class="id">msg_key</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>)) <span class="id">pending</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pending</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>).[<span class="id">msg_key</span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">key_ustate</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) <span class="id">ustate_post</span> <span class="id">sent</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">key_ustate</span>].(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">key_ustate</span>] ; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#snd">snd</a></span> <span class="id">pending</span> ~&gt; (<span class="id">ustate_post</span>, <span class="id">sent</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> ~~&gt; <span class="id"><a href="Algorand.algorand_model.html#delivery_result">delivery_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">msg_key</span> <span class="id">pending</span> <span class="id">ustate_post</span> <span class="id">sent</span><br/>
<br/>
| <span class="id"><a name="step_internal">step_internal</a></span> : <span class="docright">(* progress based on an internal step of a user (honest users only)  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pre</span> <span class="id">uid</span> (<span class="id">ustate_key</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">ustate_key</span>].(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ustate_post</span> <span class="id">sent</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">ustate_key</span>] ~&gt; (<span class="id">ustate_post</span>, <span class="id">sent</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> ~~&gt; <span class="id"><a href="Algorand.algorand_model.html#step_result">step_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">ustate_post</span> <span class="id">sent</span><br/>
<br/>
| <span class="id"><a name="step_exit_partition">step_exit_partition</a></span> : <span class="docright">(* recover from a partition  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pre</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#is_partitioned">is_partitioned</a></span> <span class="id">pre</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> ~~&gt; <span class="id"><a href="Algorand.algorand_model.html#recover_from_partitioned">recover_from_partitioned</a></span> <span class="id">pre</span><br/>
<br/>
| <span class="id"><a name="step_enter_partition">step_enter_partition</a></span> : <span class="docright">(* adversary action: partition the network  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pre</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#is_unpartitioned">is_unpartitioned</a></span> <span class="id">pre</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> ~~&gt; <span class="id"><a href="Algorand.algorand_model.html#make_partitioned">make_partitioned</a></span> <span class="id">pre</span><br/>
<br/>
| <span class="id"><a name="step_corrupt_user">step_corrupt_user</a></span> : <span class="docright">(* adversary action: corrupt a user  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pre</span> <span class="id">uid</span> (<span class="id">ustate_key</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">ustate_key</span>].(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> ~~&gt; @<span class="id"><a href="Algorand.algorand_model.html#corrupt_user_result">corrupt_user_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">ustate_key</span><br/>
<br/>
| <span class="id"><a name="step_replay_msg">step_replay_msg</a></span> : <span class="docright">(* adversary action: replay a message seen before  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pre</span> <span class="id">uid</span> (<span class="id">ustate_key</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) <span class="id">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">ustate_key</span>].(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">msg</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> ~~&gt; <span class="id"><a href="Algorand.algorand_model.html#replay_msg_result">replay_msg_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">msg</span><br/>
<br/>
| <span class="id"><a name="step_forge_msg">step_forge_msg</a></span> : <span class="docright">(* adversary action: forge and send out a message  *)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">pre</span> <span class="id">sender</span> (<span class="id">sender_key</span> : <span class="id">sender</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> <span class="id">mtype</span> <span class="id">mval</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#have_keys">have_keys</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">sender_key</span>] <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">sender</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#mtype_matches_step">mtype_matches_step</a></span> <span class="id">mtype</span> <span class="id">mval</span> <span class="id">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pre</span> ~~&gt; <span class="id"><a href="Algorand.algorand_model.html#forge_msg_result">forge_msg_result</a></span> <span class="id">pre</span> <span class="id">sender</span> <span class="id">r</span> <span class="id">p</span> <span class="id">mtype</span> <span class="id">mval</span><br/>
<br/>
<span class="kwd">where</span> "<span class="id">x</span> ~~&gt; <span class="id">y</span>" := (<span class="id"><a href="Algorand.algorand_model.html#GTransition">GTransition</a></span> <span class="id">x</span> <span class="id">y</span>) : <span class="id">type_scope</span>.<br/>
<br/>
<h2> Reachability for global transition relation </h2>
<br/>
<div class="doc">There is a step at index <span class="bracket"><span class="id">n</span></span> from <span class="bracket"><span class="id">g1</span></span> to <span class="bracket"><span class="id">g2</span></span> along a path <span class="bracket"><span class="id">p</span></span>.
This means that <span class="bracket"><span class="id">g1</span></span> and <span class="bracket"><span class="id">g2</span></span> are adjacent elements in the path. </div>
<span class="kwd">Definition</span> <span class="id"><a name="step_in_path_at">step_in_path_at</a></span> (<span class="id">g1</span> <span class="id">g2</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) <span class="id">n</span> (<span class="id">p</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#drop">drop</a></span> <span class="id">n</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">g1</span>' :: <span class="id">g2</span>' :: <span class="id">_</span> =&gt; [/\ <span class="id">g1</span>' = <span class="id">g1</span> &amp; <span class="id">g2</span>' = <span class="id">g2</span>]<br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Definition of reachable global state via paths. </div>
<span class="kwd">Definition</span> <span class="id"><a name="gtransition">gtransition</a></span> : <span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrbool.html#rel">rel</a></span> <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span> := [<span class="id">rel</span> <span class="id">x</span> <span class="id">y</span> | `[&lt;<span class="id"><a href="Algorand.algorand_model.html#GTransition">GTransition</a></span> <span class="id">x</span> <span class="id">y</span>&gt;] ].<br/>
<br/>
<div class="doc">A trace starts from <span class="bracket"><span class="id">g0</span></span> and transitions via <span class="bracket"><span class="id">GTransition</span></span> at each step in the path <span class="bracket"><span class="id">p</span></span>. </div>
<span class="kwd">Definition</span> <span class="id"><a name="is_trace">is_trace</a></span> (<span class="id">g0</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) (<span class="id">p</span> : <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssreflect.html#nosimpl">nosimpl</a></span> <span class="kwd">match</span> <span class="id">p</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [::] =&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Logic.html#False">False</a></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [:: <span class="id">g</span>' &amp; <span class="id">rest</span>] =&gt; [/\ <span class="id">g0</span> = <span class="id">g</span>' &amp; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.path.html#path">path</a></span> <span class="id"><a href="Algorand.algorand_model.html#gtransition">gtransition</a></span> <span class="id">g0</span> <span class="id">rest</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<div class="doc">Reachability between pairs of states under the reflexive-transitive closure of the transition relation. </div>
<span class="kwd">Definition</span> <span class="id"><a name="greachable">greachable</a></span> (<span class="id">g0</span> <span class="id">g</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="kwd">Prop</span> := <span class="kwd">exists2</span> <span class="id">p</span>, <span class="id"><a href="Algorand.algorand_model.html#is_trace">is_trace</a></span> <span class="id">g0</span> <span class="id">p</span> &amp; <span class="id">g</span> = <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#last">last</a></span> <span class="id">g0</span> <span class="id">p</span>.<br/>
<br/>
<div class="doc">Classic definition of reachable global state. </div>
<span class="kwd">Definition</span> <span class="id"><a name="GReachable">GReachable</a></span> (<span class="id">g0</span> <span class="id">g</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="kwd">Prop</span> := <span class="id"><a href="https://coq.inria.fr/library/Coq.Relations.Relation_Operators.html#clos_refl_trans_1n">clos_refl_trans_1n</a></span> <span class="id">_</span> <span class="id"><a href="Algorand.algorand_model.html#GTransition">GTransition</a></span> <span class="id">g0</span> <span class="id">g</span>.<br/>
<br/>
<div class="doc">We next prove that the above notions of reachability are equivalent in our setting. </div>
<br/>
<div class="doc">Our definition of reachability implies the classic definition of reachable states. </div>
<span class="kwd">Lemma</span> <span class="id"><a name="greachable_GReachable">greachable_GReachable</a></span> : <span class="kwd">forall</span> <span class="id">g0</span> <span class="id">g</span>, <span class="id"><a href="Algorand.algorand_model.html#greachable">greachable</a></span> <span class="id">g0</span> <span class="id">g</span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#GReachable">GReachable</a></span> <span class="id">g0</span> <span class="id">g</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof8')">Proof.</span></div>
<div class="proofscript" id="proof8">
&nbsp;&nbsp;<span class="id">move</span> =&gt; <span class="id">g0</span> <span class="id">g</span>; <span class="id">case</span> =&gt; <span class="id">x</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">x</span>. <span class="id">inversion</span> 1.<br/>
&nbsp;&nbsp;<span class="id">move</span> =&gt; [<span class="id">H_g0</span> <span class="id">H_path</span>]; <span class="id">subst</span> <span class="id">g1</span>.<br/>
&nbsp;&nbsp;<span class="id">revert</span> <span class="id">H_path</span>.<br/>
&nbsp;&nbsp;<span class="id">move</span>: <span class="id">g0</span> <span class="id">g</span>.<br/>
&nbsp;&nbsp;<span class="id">elim</span>: <span class="id">x</span> =&gt; /=; <span class="id">first</span> <span class="kwd">by</span> <span class="id">move</span> =&gt; <span class="id">g0</span> <span class="id">g</span> <span class="id">Ht</span> -&gt;; <span class="id">exact</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Relations.Relation_Operators.html#rt1n_refl">rt1n_refl</a></span>.<br/>
&nbsp;&nbsp;<span class="id">move</span> =&gt; <span class="id">g1</span> <span class="id">p</span> <span class="id">IH</span> <span class="id">g0</span> <span class="id">g</span>.<br/>
&nbsp;&nbsp;<span class="id">move</span>/<span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrbool.html#andP">andP</a></span> =&gt; [<span class="id">Hg</span> <span class="id">Hp</span>] <span class="id">Hgg</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span> <span class="id">IH</span>' := <span class="id">IH</span> <span class="id">_</span> <span class="id">_</span> <span class="id">Hp</span> <span class="id">Hgg</span>.<br/>
&nbsp;&nbsp;<span class="id">move</span>: <span class="id">IH</span>'; <span class="id">apply</span>: <span class="id"><a href="https://coq.inria.fr/library/Coq.Relations.Relation_Operators.html#rt1n_trans">rt1n_trans</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> <span class="id">move</span>: <span class="id">Hg</span>; <span class="id">move</span>/<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.analysis.boolp.html#asboolP">asboolP</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">Classic definition of reachable states implies our definition of reachable states. </div>
<span class="kwd">Lemma</span> <span class="id"><a name="GReachable_greachable">GReachable_greachable</a></span> : <span class="kwd">forall</span> <span class="id">g0</span> <span class="id">g</span>, <span class="id"><a href="Algorand.algorand_model.html#GReachable">GReachable</a></span> <span class="id">g0</span> <span class="id">g</span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#greachable">greachable</a></span> <span class="id">g0</span> <span class="id">g</span>.<br/>
<div><span class="toggleproof" onclick="toggleDisplay('proof9')">Proof.</span></div>
<div class="proofscript" id="proof9">
&nbsp;&nbsp;<span class="id">move</span> =&gt; <span class="id">g0</span> <span class="id">g</span>.<br/>
&nbsp;&nbsp;<span class="id">elim</span>. <span class="id">move</span> =&gt; <span class="id">x</span>; <span class="kwd">exists</span> [:: <span class="id">x</span>]; <span class="id">done</span>.<br/>
&nbsp;&nbsp;<span class="id">move</span> =&gt; <span class="id">x</span> <span class="id">y</span> <span class="id">z</span> <span class="id">Hxy</span> <span class="id">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id">case</span> =&gt; <span class="id">p</span> <span class="id">Hp</span> <span class="id">Hl</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Algorand.algorand_model.html#is_trace">is_trace</a></span> <span class="kwd">in</span> <span class="id">Hp</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">p</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct</span> <span class="id">Hp</span> <span class="kwd">as</span> [<span class="id">Hy</span> <span class="id">Hp</span>].<br/>
&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">x</span> :: <span class="id">y</span> :: <span class="id">p</span>) =&gt; //=; <span class="id">last</span> <span class="kwd">by</span> <span class="id">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">unfold</span> <span class="id"><a href="Algorand.algorand_model.html#is_trace">is_trace</a></span>; <span class="id">split</span>; <span class="id">first</span> <span class="kwd">by</span> [].<br/>
&nbsp;&nbsp;<span class="id">apply</span>/<span class="id"><a href="https://coq.inria.fr/library/Coq.ssr.ssrbool.html#andP">andP</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">by</span> <span class="id">split</span> =&gt; //; <span class="id">apply</span>/<span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.analysis.boolp.html#asboolP">asboolP</a></span>.<br/>
Qed.</div>
<br/>
<h2> Labeling global transitions </h2>
<br/>
<div class="doc">Labels to classify transitions more abstractly. </div>
<span class="kwd">Inductive</span> <span class="id"><a name="GLabel">GLabel</a></span> : <span class="kwd">Type</span> :=<br/>
| <span class="id"><a name="lbl_tick">lbl_tick</a></span> :  <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.RIneq.html#posreal">posreal</a></span> -&gt; <span class="id">GLabel</span><br/>
| <span class="id"><a name="lbl_deliver">lbl_deliver</a></span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Reals.Rdefinitions.html#RbaseSymbolsImpl.R">R</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span> -&gt; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span> -&gt; <span class="id">GLabel</span><br/>
| <span class="id"><a name="lbl_step_internal">lbl_step_internal</a></span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="https://math-comp.github.io/htmldoc/mathcomp.ssreflect.seq.html#seq">seq</a></span> <span class="id"><a href="Algorand.algorand_model.html#Msg">Msg</a></span> -&gt; <span class="id">GLabel</span><br/>
| <span class="id"><a name="lbl_exit_partition">lbl_exit_partition</a></span> : <span class="id">GLabel</span><br/>
| <span class="id"><a name="lbl_enter_partition">lbl_enter_partition</a></span> : <span class="id">GLabel</span><br/>
| <span class="id"><a name="lbl_corrupt_user">lbl_corrupt_user</a></span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id">GLabel</span><br/>
| <span class="id"><a name="lbl_replay_msg">lbl_replay_msg</a></span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id">GLabel</span><br/>
| <span class="id"><a name="lbl_forge_msg">lbl_forge_msg</a></span> : <span class="id"><a href="Algorand.algorand_model.html#UserId">UserId</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="https://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#MessageType">MessageType</a></span> -&gt; <span class="id"><a href="Algorand.algorand_model.html#ExValue">ExValue</a></span> -&gt; <span class="id">GLabel</span>.<br/>
<br/>
<div class="doc">Specify when labels classify a transition between pairs of global states. </div>
<span class="kwd">Definition</span> <span class="id"><a name="related_by">related_by</a></span> (<span class="id">label</span> : <span class="id"><a href="Algorand.algorand_model.html#GLabel">GLabel</a></span>) (<span class="id">pre</span> <span class="id">post</span> : <span class="id"><a href="Algorand.algorand_model.html#GState">GState</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">label</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#lbl_tick">lbl_tick</a></span> <span class="id">increment</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#tick_ok">tick_ok</a></span> <span class="id">increment</span> <span class="id">pre</span> /\ <span class="id">post</span> = <span class="id"><a href="Algorand.algorand_model.html#tick_update">tick_update</a></span> <span class="id">increment</span> <span class="id">pre</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#lbl_deliver">lbl_deliver</a></span> <span class="id">uid</span> <span class="id"><a href="Algorand.algorand_model.html#deadline">deadline</a></span> <span class="id">delivered_msg</span> <span class="id">sent</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">key_ustate</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) <span class="id">ustate_post</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">key_ustate</span>] ; <span class="id">delivered_msg</span> ~&gt; (<span class="id">ustate_post</span>,<span class="id">sent</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ ~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">key_ustate</span>].(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="kwd">exists</span> (<span class="id">key_mailbox</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">deadline</span>,<span class="id">delivered_msg</span>) \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_in_transit">msg_in_transit</a></span>).[<span class="id">key_mailbox</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">post</span> = <span class="id"><a href="Algorand.algorand_model.html#delivery_result">delivery_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">key_mailbox</span> (<span class="id">deadline</span>,<span class="id">delivered_msg</span>) <span class="id">ustate_post</span> <span class="id">sent</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#lbl_step_internal">lbl_step_internal</a></span> <span class="id">uid</span> <span class="id">sent</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">key_user</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) <span class="id">ustate_post</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">key_user</span>].(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">uid</span> # <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">key_user</span>] ~&gt; (<span class="id">ustate_post</span>,<span class="id">sent</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">post</span> = <span class="id"><a href="Algorand.algorand_model.html#step_result">step_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">ustate_post</span> <span class="id">sent</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#lbl_exit_partition">lbl_exit_partition</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#is_partitioned">is_partitioned</a></span> <span class="id">pre</span> /\ <span class="id">post</span> = <span class="id"><a href="Algorand.algorand_model.html#recover_from_partitioned">recover_from_partitioned</a></span> <span class="id">pre</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#lbl_enter_partition">lbl_enter_partition</a></span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#is_unpartitioned">is_unpartitioned</a></span> <span class="id">pre</span> /\ <span class="id">post</span> = <span class="id"><a href="Algorand.algorand_model.html#make_partitioned">make_partitioned</a></span> <span class="id">pre</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#lbl_corrupt_user">lbl_corrupt_user</a></span> <span class="id">uid</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">ustate_key</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">ustate_key</span>].(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">post</span> = @<span class="id"><a href="Algorand.algorand_model.html#corrupt_user_result">corrupt_user_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">ustate_key</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#lbl_replay_msg">lbl_replay_msg</a></span> <span class="id">uid</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">ustate_key</span> : <span class="id">uid</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) <span class="id">msg</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">ustate_key</span>].(<span class="id"><a href="Algorand.algorand_model.html#corrupt">corrupt</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">msg</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#msg_history">msg_history</a></span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">post</span> = <span class="id"><a href="Algorand.algorand_model.html#replay_msg_result">replay_msg_result</a></span> <span class="id">pre</span> <span class="id">uid</span> <span class="id">msg</span><br/>
&nbsp;&nbsp;| <span class="id"><a href="Algorand.algorand_model.html#lbl_forge_msg">lbl_forge_msg</a></span> <span class="id">sender</span> <span class="id">r</span> <span class="id">p</span> <span class="id">mtype</span> <span class="id">mval</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">exists</span> (<span class="id">sender_key</span> : <span class="id">sender</span> \<span class="kwd">in</span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>)) <span class="id">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id"><a href="Algorand.algorand_model.html#have_keys">have_keys</a></span> <span class="id">pre</span>.(<span class="id"><a href="Algorand.algorand_model.html#users">users</a></span>).[<span class="id">sender_key</span>] <span class="id">r</span> <span class="id">p</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Algorand.algorand_model.html#comm_cred_step">comm_cred_step</a></span> <span class="id">sender</span> <span class="id">r</span> <span class="id">p</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="Algorand.algorand_model.html#mtype_matches_step">mtype_matches_step</a></span> <span class="id">mtype</span> <span class="id">mval</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">post</span> = <span class="id"><a href="Algorand.algorand_model.html#forge_msg_result">forge_msg_result</a></span> <span class="id">pre</span> <span class="id">sender</span> <span class="id">r</span> <span class="id">p</span> <span class="id">mtype</span> <span class="id">mval</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
